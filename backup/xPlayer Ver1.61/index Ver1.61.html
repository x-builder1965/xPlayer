<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xPlayer -å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼-</title>
    <link rel="icon" type="image/x-icon" href="xPlayer.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #1c2526;
            color: #ffffff;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }
        .video-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: auto;
        }
        video {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
            border: none;
            touch-action: none;
        }
        iframe#youtubePlayer {
            width: 100vw;
            height: 100vh;
            border: none;
            display: none;
        }
        .filename,
        .controls {
            position: absolute;
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            transition: opacity 0.3s ease;
        }
        .filename {
            top: 20px;
        }
        .controls {
            bottom: 20px;
        }
        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .left-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 6px 12px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            min-width: 40px;
            position: relative;
        }
        button:hover {
            background-color: #0056b3;
        }
        button#folderInput.resume-active,
        button#videoInput.resume-active {
            background-color: #ff0000;
        }
        button#folderInput.resume-active:hover,
        button#videoInput.resume-active:hover {
            background-color: #cc0000;
        }
        input[type="range"] {
            flex: 1;
            accent-color: #007bff;
            height: 8px;
            background: #555;
            border-radius: 5px;
            outline: none;
            position: relative;
        }
        input[type="range"]:hover {
            accent-color: #ff0000;
        }
        input[type="range"]#volumeBar {
            flex: none;
            width: 10%;
        }
        #seekBar:hover,
        #volumeBar:hover {
            background: rgba(0, 123, 255, 0.2);
            cursor: pointer;
        }
        #seekBar::-webkit-slider-thumb,
        #volumeBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
        }
        #seekBar:hover::-webkit-slider-thumb,
        #volumeBar:hover::-webkit-slider-thumb {
            background: #ff0000;
            transform: scale(1.5);
        }
        #seekBar::-moz-range-thumb,
        #volumeBar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007bff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }
        #seekBar:hover::-moz-range-thumb,
        #volumeBar:hover::-moz-range-thumb {
            background: #ff0000;
            transform: scale(1.5);
        }
        input[type="file"] {
            display: none;
        }
        input#urlInput {
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 16px;
            width: 90%;
            display: none;
        }
        select#filenameDisplay,
        select#sizeSelect {
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 16px;
            box-sizing: border-box;
            cursor: pointer;
            position: relative;
        }
        select#filenameDisplay {
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        select#sizeSelect {
            width: 100px;
        }
        select#filenameDisplay option,
        select#sizeSelect option {
            background: #1c2526;
            color: #ffffff;
        }
        #timeDisplay, #volumeDisplay {
            color: #ffffff;
            font-size: 16px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }
        .spacer {
            min-width: 10px;
        }
        #overlayDisplay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            transition: opacity 0.3s ease;
            opacity: 0;
            pointer-events: none;
            text-align: center;
            white-space: normal;
            word-wrap: break-word;
            max-width: 80vw;
        }
        #overlayDisplay.active {
            opacity: 1;
        }
        .app-name-and-copyright {
            margin-left: auto;
            color: #ffffff;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 5px;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        .tooltip.visible {
            opacity: 1;
        }
        button:hover .tooltip,
        input[type="range"]:hover .tooltip,
        input#urlInput:hover .tooltip,
        select:hover .tooltip {
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        #youtubeCloseBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: none;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        .url-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="videoPlayer" src=""></video>
        <iframe id="youtubePlayer" src="" allow="autoplay; fullscreen" allowfullscreen></iframe>
        <div class="filename">
            <select id="filenameDisplay" data-tooltip="å†ç”Ÿå‹•ç”»ãƒªã‚¹ãƒˆ">
                <option value=""></option>
            </select>
            <div class="url-controls">
                <input id="urlInput" type="text" placeholder="YouTube URLã‚’å…¥åŠ›" data-tooltip="YouTube URLã‚’å…¥åŠ›">
                <button id="urlConfirmBtn" data-tooltip="URLå†ç”Ÿ">âœ…</button>
                <button id="urlCancelBtn" data-tooltip="ã‚­ãƒ£ãƒ³ã‚»ãƒ«">âŒ</button>
            </div>
        </div>
        <div id="overlayDisplay"></div>
        <div class="controls">
            <div class="control-row">
                <div class="left-controls">
                    <button id="folderInput" data-tooltip="ãƒ•ã‚©ãƒ«ãƒ€é¸æŠ">ğŸ“</button>
                    <button id="videoInput" data-tooltip="å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ">ğŸ—’ï¸</button>
                    <button id="urlInputBtn" data-tooltip="ãƒãƒƒãƒˆå‹•ç”»é¸æŠ">ğŸŒ</button>
                    <span class="spacer"></span>
                    <button id="prevVideoBtn" data-tooltip="å‰ã®å‹•ç”»ã¸ï¼ˆPgUpï¼‰">â®ï¸</button>
                    <button id="rewindBtn" data-tooltip="30ç§’æˆ»ã‚‹ï¼ˆâ†ï¼Swipe Leftï¼‰">âª</button>
                    <button id="playPauseBtn" data-tooltip="å†ç”Ÿï¼ˆSpaceï¼‰">â–¶ï¸</button>
                    <button id="fastForwardBtn" data-tooltip="30ç§’é€²ã‚€ï¼ˆâ†’ï¼Swipe Rightï¼‰">â©</button>
                    <button id="nextVideoBtn" data-tooltip="æ¬¡ã®å‹•ç”»ã¸ï¼ˆPgDwï¼‰">â­ï¸</button>
                    <span class="spacer"></span>
                    <button id="fitModeBtn" data-tooltip="æ¨ªã«åˆã‚ã›ã‚‹">â†•ï¸</button>
                    <select id="sizeSelect" data-tooltip="ã‚µã‚¤ã‚ºå¤‰æ›´">
                        <option value="10">10%</option>
                        <option value="25">25%</option>
                        <option value="50" selected>50%</option>
                        <option value="75">75%</option>
                        <option value="100">100%</option>
                    </select>
                    <button id="fullscreenBtn" data-tooltip="ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º">ğŸ–¥ï¸</button>
                </div>
                <label class="app-name-and-copyright" id="appNameAndCopyright" data-tooltip="ã‚¢ãƒ—ãƒªæƒ…å ±"></label>
            </div>
            <div class="control-row">
                <button id="volumeMuteBtn" data-tooltip="ãƒŸãƒ¥ãƒ¼ãƒˆ/ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤">ğŸ”Š</button>
                <span id="volumeDisplay" data-tooltip="éŸ³é‡ï¼ˆâ†‘â†“ï¼Swipe Up Downï¼‰">20%</span>
                <input type="range" id="volumeBar" value="0.2" min="0" max="1" step="0.01" data-tooltip="éŸ³é‡å¤‰æ›´ï¼ˆâ†‘â†“ï¼Swipe Up Downï¼‰">
                <span id="timeDisplay" data-tooltip="å†ç”Ÿæ™‚é–“/å‹•ç”»æ™‚é–“ï¼ˆâ†â†’ï¼Swipe Left Rightï¼‰">0:00:00 / 0:00:00</span>
                <input type="range" id="seekBar" value="0" min="0" max="100" data-tooltip="å†ç”Ÿä½ç½®å¤‰æ›´ï¼ˆâ†â†’ï¼Swipe Left Rightï¼‰">
            </div>
        </div>
        <button id="youtubeCloseBtn" data-tooltip="ãƒãƒƒãƒˆå‹•ç”»å†ç”Ÿçµ‚äº†">âŒ</button>
        <input type="file" id="hiddenFolderInput" webkitdirectory directory multiple accept="video/*,video/x-matroska" style="display: none;">
        <input type="file" id="hiddenVideoInput" accept="video/*,video/x-matroska" style="display: none;">
    </div>

    <script>
        // ---------------------------------------------------------------------
        const copyright = 'Copyright Â© 2025 @x-builder, Japan';
        const email = 'x-builder@gmail.com';
        const appName = 'xPlayer -å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼- Ver1.61';
        // ---------------------------------------------------------------------
        // [å¤‰æ›´å±¥æ­´]
        // 2025-10-15 Ver1.00 æ–°è¦é–‹ç™º
        // 2025-10-18 Ver1.01 ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã€ãƒã‚¦ã‚¹æ“ä½œï¼ˆå†ç”Ÿï¼ä¸€æ™‚åœæ­¢ã€ã‚·ãƒ¼ã‚¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼‰è¿½åŠ 
        // 2025-10-18 Ver1.02 ãƒã‚¦ã‚¹ä¸Šä¸‹ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒœãƒªãƒ¥ãƒ¼ãƒ å¤‰æ›´ã‚’è¿½åŠ 
        // 2025-10-18 Ver1.03 èµ·å‹•æ™‚ã«ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«appNameã‚’è¡¨ç¤ºã€å†ç”Ÿæ™‚é–“/å‹•ç”»æ™‚é–“ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ é‡ã®è¡¨ç¤ºã‚’è¿½åŠ 
        // 2025-10-18 Ver1.04 timeDisplayã‚’æ™‚:åˆ†:ç§’ï¼ˆ0:00:00 / 0:00:00ï¼‰å½¢å¼ã«å¤‰æ›´
        // 2025-10-18 Ver1.05 playPauseBtnã®å·¦å³ã«å‰å‹•ç”»/å‰30ç§’/æ¬¡30ç§’/æ¬¡å‹•ç”»ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        // 2025-10-18 Ver1.06 volumeMuteBtnã®ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤æ™‚ã«ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒ0%ã«ãªã‚‹å•é¡Œã‚’ä¿®æ­£
        // 2025-10-18 Ver1.07 custom-file-buttonã€nextVideoBtnã®å³å´ã«ãƒœã‚¿ãƒ³1ã¤åˆ†ã®ä½™ç™½ã‚’è¿½åŠ 
        // 2025-10-19 Ver1.08 ã‚·ãƒ¼ã‚¯ä¸­ã®æ™‚é–“ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ å¤‰æ›´ä¸­ã®é‡ã‚’ç”»é¢ä¸­å¤®ã«è¡¨ç¤º
        // 2025-10-19 Ver1.09 è¡¨ç¤ºã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆçŸ¢å°ã‚­ãƒ¼ã€ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
        // 2025-10-19 Ver1.10 PgUp/PgDnã§å‰å‹•ç”»/æ¬¡å‹•ç”»ã€Home/Endã§å…ˆé ­å‹•ç”»/æœ€çµ‚å‹•ç”»ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¿½åŠ 
        // 2025-10-19 Ver1.11 overlayDisplayã®éè¡¨ç¤ºã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’.filenameã€.controlsã«åŒæœŸ
        // 2025-10-19 Ver1.12 Firefoxå¯¾å¿œã®ãŸã‚ã€ãƒ•ã‚©ãƒ«ãƒ€é¸æŠã‚’webkitdirectoryã«å¤‰æ›´
        // 2025-10-19 Ver1.13 ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’.controlsã€.filenameã«åŒæœŸ
        // 2025-10-20 Ver1.14 appNameAndCopyrightã«${appName}ã€€ã€€${copyright}ã‚’è¨­å®š
        // 2025-10-20 Ver1.15 ãƒ•ã‚©ãƒ«ãƒ€é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ç¶­æŒ
        // 2025-10-20 Ver1.16 ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’è¨­å®š
        // 2025-10-20 Ver1.17 ã‚·ãƒ¼ã‚¯ä¸­ã«æ˜ åƒã‚‚å¤‰ãˆã‚‹
        // 2025-10-20 Ver1.18 ã‚·ãƒ¼ã‚¯ä¸­ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¼·åŒ–ã€ã‚·ãƒ¼ã‚¯é€Ÿåº¦èª¿æ•´
        // 2025-10-20 Ver1.19 ã‚µãƒ ãƒã‚¤ãƒ«ã«æ™‚é–“è¡¨ç¤ºã€ã‚·ãƒ¼ã‚¯æ„Ÿåº¦UIã€ãƒ‡ãƒã‚¦ãƒ³ã‚¹
        // 2025-10-20 Ver1.20 ã‚·ãƒ¼ã‚¯æ„Ÿåº¦ã‚’ä½é€Ÿï¼ˆ0.5ï¼‰ã«å›ºå®š
        // 2025-10-20 Ver1.21 ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºã®ä¿®æ­£ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹50msã€seekedãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ãƒ­ã‚°è¿½åŠ ï¼‰
        // 2025-10-20 Ver1.22 thumbnailPreviewã‚’å»ƒæ­¢
        // 2025-10-20 Ver1.23 .filenameã€.controlsã€.overlayDisplayã®ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã€éè¡¨ç¤ºã‚’æŠ‘æ­¢
        // 2025-10-20 Ver1.24 .overlayDisplayä¸Šã§ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã‚‚ã‚·ãƒ¼ã‚¯ç¶™ç¶š
        // 2025-10-20 Ver1.25 ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã«ãƒã‚¦ã‚¹ãƒ›ãƒãƒ¼ã§æ™‚é–“è¡¨ç¤ºã€ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¼·åŒ–ã€å‹•ç”»ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼é€šçŸ¥
        // 2025-10-20 Ver1.26 <title>ã‹ã‚‰Ver1.25ã‚’å‰Šé™¤ã€appNameã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’Ver1.26ã«ã‚«ã‚¦ãƒ³ãƒˆ
        // 2025-10-20 Ver1.27 èµ·å‹•æ™‚ã®å‹•ç”»ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼ˆalertï¼‰ã‚’æŠ‘åˆ¶
        // 2025-10-20 Ver1.28 èµ·å‹•æ™‚ã®èª¤ã£ãŸã‚¨ãƒ©ãƒ¼æŠ‘åˆ¶ã‚’ä¿®æ­£
        // 2025-10-20 Ver1.29 ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã®è¦–è¦šå¼·åŒ–ï¼ˆãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯ã¨ã‚«ãƒ¼ã‚½ãƒ«ï¼‰
        // 2025-10-21 Ver1.30 volumeBarã®ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«éŸ³é‡è¡¨ç¤º
        // 2025-10-21 Ver1.31 volumeBarã€seekBarã®ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼è§£é™¤æ™‚ã«overlayDisplayã‚’éè¡¨ç¤º
        // 2025-10-21 Ver1.32 ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã‚’âŒã«å¤‰æ›´ã€#overlayDisplay.draggingã‚’å‰Šé™¤
        // 2025-10-21 Ver1.33 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚µã‚¤ã‚ºèª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ 
        // 2025-10-21 Ver1.34 sizeSelectåˆæœŸå€¤ã‚’50%ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼é¸æŠå·¦å´ã‚’èµ¤è‰²ã€èµ·å‹•æ™‚ã®overlayDisplayæŠ‘åˆ¶
        // 2025-10-21 Ver1.35 folderInput, videoInputã‚’<button>ã«å¤‰æ›´
        // 2025-10-21 Ver1.36 input[type="range"]ã®accent-colorã‚’#007bffã«å¤‰æ›´ã€appearanceé–¢é€£ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å‰Šé™¤
        // 2025-10-21 Ver1.37 sizeSelectã®å·¦æ¨ªã«ã‚µã‚¤ã‚ºï¼ˆXX%ï¼‰ã‚’è¡¨ç¤ºã€folderInputã‹ã‚‰fullscreenBtnã‚’å·¦å¯„ã›ã€appNameAndCopyrightã‚’å³å¯„ã›
        // 2025-10-21 Ver1.38 sizeSelectã‚’ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆï¼ˆ10%ã€œ100%ï¼‰ã«å¤‰æ›´ã€controlSizeDisplayå‰Šé™¤ã€
        //                   èµ·å‹•æ™‚ã®overlayDisplayã‚’50%ã§è¡¨ç¤ºã€overlayDisplayã®ã‚µã‚¤ã‚ºã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã«é€£å‹•
        // 2025-10-21 Ver1.39 sizeSelectã®é¸æŠå€¤ã‚’10%,25%,50%,75%,100%ã«å¤‰æ›´ã€sizeSelectã®å¹…ã‚’100pxã«å›ºå®š
        // 2025-10-21 Ver1.40 controlsãŒç”»é¢å¹…ã«åã¾ã‚‰ãªã„å ´åˆã«æŠ˜ã‚Šè¿”ã™
        // 2025-10-21 Ver1.41 sizeSelectã€volumeBarã®å€¤ã‚’localStorageã«ä¿å­˜ã€èµ·å‹•æ™‚ã«å¾©å…ƒ
        // 2025-10-21 Ver1.42 ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨å†ç”ŸçŠ¶æ³ã‚’localStorageã«ä¿å­˜ã€èµ·å‹•æ™‚ã«å†é–‹
        // 2025-10-21 Ver1.43 ãƒ•ã‚©ãƒ«ãƒ€é¸æŠæ™‚ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå¾©å…ƒã¨å†ç”Ÿä½ç½®é©ç”¨ã‚’ä¿®æ­£
        // 2025-10-21 Ver1.44 å†ç”Ÿæ™‚é–“ãŒæœ€åˆã«æˆ»ã‚‹å•é¡Œã‚’ä¿®æ­£ã€å†ç”Ÿä½ç½®å¾©å…ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ”¹å–„
        // 2025-10-21 Ver1.45 å†ç”Ÿä½ç½®ãŒ0ã«æˆ»ã‚‹å•é¡Œã‚’ä¿®æ­£ã€1ç§’é–“éš”ã®å®šæœŸä¿å­˜ã‚’å®Ÿè£…
        // 2025-10-21 Ver1.46 ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸æ•´åˆã‚’ä¿®æ­£ã€è‡ªå‹•å†ç”Ÿå¤±æ•—ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ”¹å–„
        // 2025-10-21 Ver1.47 currentTimeä¸Šæ›¸ãé˜²æ­¢ã€å†ç”Ÿä½ç½®å¾©å…ƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«å¤‰æ›´
        // 2025-10-21 Ver1.48 å„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã«ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¿½åŠ 
        // 2025-10-21 Ver1.49 ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’é©ç”¨ã€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—æ–‡è¨€ã‚’å¤‰æ›´
        // 2025-10-22 Ver1.50 æç”»ãƒ¢ãƒ¼ãƒ‰ï¼ˆâ†•ï¸/â†”ï¸ï¼‰ãƒœã‚¿ãƒ³ã‚’sizeSelectã®å·¦æ¨ªã«è¿½åŠ ã€ã‚¯ãƒªãƒƒã‚¯ã§ç¸¦ã«åˆã‚ã›ã‚‹/æ¨ªã«åˆã‚ã›ã‚‹ã‚’ãƒˆã‚°ãƒ«
        // 2025-10-22 Ver1.51 ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«å¿œã˜ã¦folderInputã¾ãŸã¯videoInputã‚’èµ¤è‰²ã«å¤‰æ›´ã€èµ·å‹•æ™‚ã«å†é–‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
        // 2025-10-22 Ver1.52 overlayDisplayã®å¹…ã‚’sizeSelectã®å€¤ã«é€£å‹•
        // 2025-10-22 Ver1.53 overlayDisplayã®å¹…ã‚’æ–‡å­—æ•°ã«é€£å‹•ã€ç”»é¢ä¸­å¤®ã«ã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ã€ç”»é¢å¹…ã‚’è¶…ãˆã‚‹å ´åˆã¯æŠ˜ã‚Šè¿”ã—ã€fitModeBtnã‚¯ãƒªãƒƒã‚¯æ™‚ã®overlayDisplayè¡¨ç¤ºã‚’å‰Šé™¤
        // 2025-10-22 Ver1.54 overlayDisplayã®å†é–‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚’å†é–‹å¯¾è±¡ãƒœã‚¿ãƒ³ã®ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«å¤‰æ›´ã€ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼è§£é™¤ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯æ™‚ã«éè¡¨ç¤º
        // 2025-10-22 Ver1.55 ã‚¹ãƒãƒ›ã®ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆã‚·ãƒ¼ã‚¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼‰ã«å¯¾å¿œã€å†é–‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€Œå‰å›ã¨åŒä¸€ğŸ“ã§å†é–‹å¯èƒ½ã€ã€Œå‰å›ã¨åŒä¸€ğŸ—’ï¸ã§å†é–‹å¯èƒ½ã€ã«å¤‰æ›´
        // 2025-10-22 Ver1.56 ã‚¹ãƒãƒ›ã®ã‚·ãƒ³ã‚°ãƒ«ã‚¿ãƒƒãƒ—ã§filenameã€overlayDisplayã€controlsã‚’éè¡¨ç¤ºã€ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡æ›¿
        // 2025-10-22 Ver1.57 ã‚¹ãƒãƒ›ã®ã‚·ãƒ³ã‚°ãƒ«ã‚¿ãƒƒãƒ—ã§filenameã€overlayDisplayã€controlsãŒéè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œã‚’ä¿®æ­£
        // 2025-10-22 Ver1.58 ã‚¹ãƒãƒ›ã®ã‚·ãƒ³ã‚°ãƒ«ã‚¿ãƒƒãƒ—ã‚’ãƒˆã‚°ãƒ«è¡¨ç¤º/éè¡¨ç¤ºã«å¤‰æ›´ã€ã‚¹ãƒãƒ›ã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡æ›¿
        // 2025-10-22 Ver1.59 ã‚·ãƒ³ã‚°ãƒ«ã‚¿ãƒƒãƒ—åˆ¤å®šé–¾å€¤ã‚’750ms/15pxã«èª¿æ•´ã€ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ™‚é–“é–“éš”ã‚’400msã«å¤‰æ›´ã€ã‚¹ãƒãƒ›ã§ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—æŠ‘åˆ¶ã€ã‚¹ãƒ¯ã‚¤ãƒ—æ„Ÿåº¦ã‚’æœ€é©åŒ–
        // 2025-10-23 Ver1.60 ç”»é¢ã‚µã‚¤ã‚ºã«åŸºã¥ãsizeSelectã®è‡ªå‹•èª¿æ•´ã‚’è¿½åŠ ï¼ˆ480pxä»¥ä¸‹:25%,768pxä»¥ä¸‹:50%,1200pxä»¥ä¸‹:75%,ãã‚Œä»¥ä¸Š:100%ï¼‰ã€sizeSelectã®ã‚µã‚¤ã‚ºå¤‰æ›´æ©Ÿèƒ½ã‚’ç¶­æŒ
        // 2025-10-24 Ver1.61 YouTubeå†ç”Ÿæ©Ÿèƒ½ã‚’è¿½åŠ ã€ãƒãƒƒãƒˆå‹•ç”»é¸æŠãƒœã‚¿ãƒ³ï¼ˆğŸŒï¼‰ã€URLå…¥åŠ›ã€ç¢ºå®šãƒ»å–æ¶ˆãƒœã‚¿ãƒ³ã€å†ç”Ÿçµ‚äº†ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        // ---------------------------------------------------------------------

        // è¡¨ç¤ºã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
        const overlayTimeout = 3000;
        const seekSensitivity = 0.3;
        const volumeStep = 0.005;
        const appNameAndCopyrightValue = `${appName}ã€€ã€€${copyright}`;

        const video = document.getElementById('videoPlayer');
        const youtubePlayer = document.getElementById('youtubePlayer');
        const videoContainer = document.querySelector('.video-container');
        const controls = document.querySelector('.controls');
        const folderInput = document.getElementById('folderInput');
        const videoInput = document.getElementById('videoInput');
        const urlInputBtn = document.getElementById('urlInputBtn');
        const urlInput = document.getElementById('urlInput');
        const urlConfirmBtn = document.getElementById('urlConfirmBtn');
        const urlCancelBtn = document.getElementById('urlCancelBtn');
        const urlControls = document.querySelector('.url-controls');
        const youtubeCloseBtn = document.getElementById('youtubeCloseBtn');
        const hiddenFolderInput = document.getElementById('hiddenFolderInput');
        const hiddenVideoInput = document.getElementById('hiddenVideoInput');
        const prevVideoBtn = document.getElementById('prevVideoBtn');
        const rewindBtn = document.getElementById('rewindBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const fastForwardBtn = document.getElementById('fastForwardBtn');
        const nextVideoBtn = document.getElementById('nextVideoBtn');
        const seekBar = document.getElementById('seekBar');
        const volumeMuteBtn = document.getElementById('volumeMuteBtn');
        const volumeBar = document.getElementById('volumeBar');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const sizeSelect = document.getElementById('sizeSelect');
        const fitModeBtn = document.getElementById('fitModeBtn');
        const filename = document.querySelector('.filename');
        const filenameDisplay = document.getElementById('filenameDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const volumeDisplay = document.getElementById('volumeDisplay');
        const overlayDisplay = document.getElementById('overlayDisplay');
        const appNameAndCopyright = document.getElementById('appNameAndCopyright');

        let playlist = [];
        let currentVideoIndex = 0;
        let timeout;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let touchStartTime = 0;
        let lastTouchTime = 0;
        let isVolumeDragging = false;
        let lastVolume = 0.2;
        let wasPlaying = false;
        let isMouseOverControls = false;
        let isInitialLoad = true;
        let saveInterval = null;
        let fitMode = 'contain';
        let isYouTubeMode = false;
        let controlTimeout;

        // ãƒ‡ãƒã‚¤ã‚¹åˆ¤åˆ¥ï¼ˆã‚¹ãƒãƒ›æ¤œçŸ¥ï¼‰
        function isMobileDevice() {
            return navigator.maxTouchPoints > 0 || window.matchMedia("(pointer: coarse)").matches;
        }

        // ç”»é¢ã‚µã‚¤ã‚ºã«åŸºã¥ãã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã®è¨ˆç®—
        function calculateControlSize() {
            const screenWidth = window.innerWidth;
            let sizePercent;
            if (screenWidth <= 480) {
                sizePercent = 10;
            } else if (screenWidth <= 768) {
                sizePercent = 25;
            } else if (screenWidth <= 1200) {
                sizePercent = 50;
            } else if (screenWidth <= 1700) {
                sizePercent = 75;
            } else {
                sizePercent = 100;
            }
            return sizePercent;
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã®æ›´æ–°
        function updateControlSize(value, isInitial = false) {
            const fontSize = 8 + (value / 100) * (24 - 8);
            const padding = 2 + (value / 100) * (10 - 2);
            const appNameAndCopyrightFontSize = 8 + (value / 100) * (17 - 8);
            const appNameAndCopyrightPadding = 2 + (value / 100) * (8 - 2);
            const sizeSelectWidth = 40 + (value / 100) * (124 - 40);
            const controls = document.querySelectorAll('button, select#filenameDisplay, select#sizeSelect, #timeDisplay, #volumeDisplay, #appNameAndCopyright, input#urlInput');
            controls.forEach(control => {
                if (control.id === 'appNameAndCopyright') {
                    control.style.fontSize = `${appNameAndCopyrightFontSize}px`;
                    control.style.padding = `${appNameAndCopyrightPadding}px ${appNameAndCopyrightPadding * 2}px`;
                } else {
                    control.style.fontSize = `${fontSize}px`;
                    control.style.padding = `${padding}px ${padding * 2}px`;
                }
                if (control.id === 'sizeSelect') {
                    control.style.width = `${sizeSelectWidth}px`;
                }
            });

            const overlayFontSize = 20 + (value / 100) * (160 - 20);
            overlayDisplay.style.fontSize = `${overlayFontSize}px`;
            if (!isInitial) {
                updateOverlayDisplay(`ğŸ–Œï¸ ${value}%`);
            }
            isInitialLoad = false;
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚µã‚¤ã‚ºã‚’è‡ªå‹•èª¿æ•´
        window.addEventListener('resize', () => {
            const autoSize = calculateControlSize();
            sizeSelect.value = autoSize;
            localStorage.setItem('controlSize', autoSize);
            updateControlSize(autoSize);
            showControlsAndFilename();
        });

        // åˆæœŸçŠ¶æ…‹ã§video.srcã‚’æ˜ç¤ºçš„ã«ç©ºã«è¨­å®š
        video.src = '';

        // è¡¨ç¤ºã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºé©ç”¨
        appNameAndCopyright.textContent = appNameAndCopyrightValue;

        // åˆæœŸçŠ¶æ…‹ã§ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«appNameAndCopyrightã‚’è¨­å®š
        filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;

        // localStorageã‹ã‚‰å¾©å…ƒ
        const savedControlSize = localStorage.getItem('controlSize');
        const savedVolume = localStorage.getItem('volume');
        const savedPlaylist = localStorage.getItem('playlist');
        const savedCurrentVideoIndex = localStorage.getItem('currentVideoIndex');
        const savedCurrentTime = localStorage.getItem('currentTime');
        const savedFitMode = localStorage.getItem('fitMode');

        let initialControlSize = savedControlSize && ['10', '25', '50', '75', '100'].includes(savedControlSize)
            ? parseInt(savedControlSize)
            : calculateControlSize();
        sizeSelect.value = initialControlSize;
        updateControlSize(initialControlSize, true);

        if (savedVolume && !isNaN(savedVolume) && savedVolume >= 0 && savedVolume <= 1) {
            volumeBar.value = savedVolume;
            video.volume = savedVolume;
            lastVolume = savedVolume;
            volumeMuteBtn.textContent = savedVolume == 0 ? 'ğŸ”‡' : 'ğŸ”Š';
            volumeMuteBtn.setAttribute('data-tooltip', savedVolume == 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            updateVolumeDisplay();
        } else {
            volumeBar.value = 0.2;
            video.volume = 0.2;
            lastVolume = 0.2;
            volumeMuteBtn.textContent = 'ğŸ”Š';
            volumeMuteBtn.setAttribute('data-tooltip', 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            updateVolumeDisplay();
        }

        if (savedFitMode && ['contain', 'cover'].includes(savedFitMode)) {
            fitMode = savedFitMode;
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = fitMode === 'contain' ? 'â†•ï¸' : 'â†”ï¸';
            fitModeBtn.setAttribute('data-tooltip', fitMode === 'contain' ? 'æ¨ªã«åˆã‚ã›ã‚‹' : 'ç¸¦ã«åˆã‚ã›ã‚‹');
        } else {
            fitMode = 'contain';
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = 'â†•ï¸';
            fitModeBtn.setAttribute('data-tooltip', 'æ¨ªã«åˆã‚ã›ã‚‹');
        }

        let isResumeAvailable = false;
        if (savedPlaylist && savedCurrentVideoIndex && savedCurrentTime) {
            try {
                const parsedPlaylist = JSON.parse(savedPlaylist);
                const parsedCurrentVideoIndex = parseInt(savedCurrentVideoIndex);
                if (Array.isArray(parsedPlaylist) && parsedPlaylist.length > 0 && parsedCurrentVideoIndex >= 0 && parsedCurrentVideoIndex < parsedPlaylist.length) {
                    filenameDisplay.innerHTML = `<option value="">å†ç”Ÿé€”ä¸­:â–¶ï¸ ${parsedPlaylist[parsedCurrentVideoIndex]}</option>`;
                    currentVideoIndex = parsedCurrentVideoIndex;
                    if (parsedPlaylist.length === 1) {
                        videoInput.classList.add('resume-active');
                        isResumeAvailable = true;
                    } else if (parsedPlaylist.length >= 2) {
                        folderInput.classList.add('resume-active');
                        isResumeAvailable = true;
                    }
                } else {
                    filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                }
            } catch (e) {
                filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
            }
        } else {
            filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
        }

        // å®šæœŸä¿å­˜
        function startPeriodicSave() {
            if (saveInterval) clearInterval(saveInterval);
            saveInterval = setInterval(() => {
                if (!video.paused && playlist.length > 0 && !isYouTubeMode) {
                    localStorage.setItem('currentTime', video.currentTime);
                }
            }, 1000);
        }

        function stopPeriodicSave() {
            if (saveInterval) {
                clearInterval(saveInterval);
                saveInterval = null;
            }
        }

        function savePlaylistAndPlaybackState() {
            if (playlist.length > 0 && !isYouTubeMode) {
                const playlistNames = playlist.map(item => item.name);
                localStorage.setItem('playlist', JSON.stringify(playlistNames));
                localStorage.setItem('currentVideoIndex', currentVideoIndex);
                localStorage.setItem('currentTime', video.currentTime || 0);
            } else {
                localStorage.removeItem('playlist');
                localStorage.removeItem('currentVideoIndex');
                localStorage.removeItem('currentTime');
            }
        }

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—é–¢é€£
        function showTooltip(element) {
            if (isMobileDevice()) return;
            if (element.dataset.tooltip) {
                let tooltip = element.querySelector('.tooltip');
                if (!tooltip) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = element.dataset.tooltip;
                    element.appendChild(tooltip);
                }
                tooltip.classList.add('visible');
            }
        }

        function hideTooltip(element) {
            if (isMobileDevice()) return;
            const tooltip = element.querySelector('.tooltip');
            if (tooltip) {
                tooltip.classList.remove('visible');
            }
        }

        const tooltipElements = document.querySelectorAll('[data-tooltip]');
        tooltipElements.forEach(element => {
            element.addEventListener('mouseenter', () => showTooltip(element));
            element.addEventListener('mouseleave', () => hideTooltip(element));
        });

        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        folderInput.addEventListener('click', () => {
            folderInput.classList.remove('resume-active');
            videoInput.classList.remove('resume-active');
            hideOverlayDisplay();
            hiddenFolderInput.click();
            switchToLocalMode();
        });
        videoInput.addEventListener('click', () => {
            folderInput.classList.remove('resume-active');
            videoInput.classList.remove('resume-active');
            hideOverlayDisplay();
            hiddenVideoInput.click();
            switchToLocalMode();
        });

        folderInput.addEventListener('mouseenter', () => {
            if (folderInput.classList.contains('resume-active')) {
                updateOverlayDisplay('å‰å›ã¨åŒä¸€ğŸ“ã§å†é–‹å¯èƒ½');
            }
        });
        folderInput.addEventListener('mouseleave', () => {
            if (folderInput.classList.contains('resume-active')) {
                hideOverlayDisplay();
            }
        });

        videoInput.addEventListener('mouseenter', () => {
            if (videoInput.classList.contains('resume-active')) {
                updateOverlayDisplay('å‰å›ã¨åŒä¸€ğŸ—’ï¸ã§å†é–‹å¯èƒ½');
            }
        });
        videoInput.addEventListener('mouseleave', () => {
            if (videoInput.classList.contains('resume-active')) {
                hideOverlayDisplay();
            }
        });

        urlInputBtn.addEventListener('click', () => {
            filenameDisplay.style.display = 'none';
            urlControls.style.display = 'flex';
            urlInput.style.display = 'inline-block';
            urlConfirmBtn.style.display = 'inline-block';
            urlCancelBtn.style.display = 'inline-block';
            urlInput.focus();
            showControlsAndFilename();
        });

        urlConfirmBtn.addEventListener('click', () => {
            const url = urlInput.value.trim();
            if (url) {
                const videoId = extractYouTubeVideoId(url);
                if (videoId) {
                    video.pause();
                    isYouTubeMode = true;
                    video.style.display = 'none';
                    youtubePlayer.style.display = 'block';
                    youtubePlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1`;
                    filename.style.display = 'none';
                    controls.style.display = 'none';
                    overlayDisplay.style.display = 'none';
                    youtubeCloseBtn.style.display = 'block';
                    showYouTubeControls();
                } else {
                    updateOverlayDisplay('ç„¡åŠ¹ãªYouTube URLã§ã™');
                }
            }
            hideURLInputControls();
        });

        urlCancelBtn.addEventListener('click', () => {
            hideURLInputControls();
            filenameDisplay.style.display = 'block';
            showControlsAndFilename();
        });

        youtubeCloseBtn.addEventListener('click', () => {
            switchToLocalMode();
        });

        function extractYouTubeVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        function switchToLocalMode() {
            isYouTubeMode = false;
            video.style.display = 'block';
            youtubePlayer.style.display = 'none';
            youtubePlayer.src = '';
            filename.style.display = 'block';
            controls.style.display = 'flex';
            urlControls.style.display = 'none';
            filenameDisplay.style.display = 'block';
            youtubeCloseBtn.style.display = 'none';
            // updatePlaylistDisplay();
            if (playlist.length > 0) {
                filenameDisplay.innerHTML = `<option value="">å†ç”Ÿé€”ä¸­:â–¶ï¸ ${parsedPlaylist[parsedCurrentVideoIndex]}</option>`;
            } else {
                video.src = '';
                filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
            }
            showControlsAndFilename();
            startPeriodicSave();
        }

        function hideURLInputControls() {
            urlControls.style.display = 'none';
            urlInput.style.display = 'none';
            urlConfirmBtn.style.display = 'none';
            urlCancelBtn.style.display = 'none';
            urlInput.value = '';
        }

        function showYouTubeControls() {
            clearTimeout(controlTimeout);
            youtubeCloseBtn.style.opacity = '1';
            controlTimeout = setTimeout(() => {
                if (!isMouseOverControls) {
                    youtubeCloseBtn.style.opacity = '0';
                }
            }, overlayTimeout);
        }

        youtubeCloseBtn.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(controlTimeout);
            youtubeCloseBtn.style.opacity = '1';
        });

        youtubeCloseBtn.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showYouTubeControls();
        });

        videoContainer.addEventListener('mousemove', () => {
            if (isYouTubeMode) {
                showYouTubeControls();
            } else {
                showControlsAndFilename();
            }
        });

        // æç”»ãƒ¢ãƒ¼ãƒ‰
        fitModeBtn.addEventListener('click', () => {
            fitMode = fitMode === 'contain' ? 'cover' : 'contain';
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = fitMode === 'contain' ? 'â†•ï¸' : 'â†”ï¸';
            fitModeBtn.setAttribute('data-tooltip', fitMode === 'contain' ? 'æ¨ªã«åˆã‚ã›ã‚‹' : 'ç¸¦ã«åˆã‚ã›ã‚‹');
            localStorage.setItem('fitMode', fitMode);
            showControlsAndFilename();
        });

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨ãƒ•ã‚¡ã‚¤ãƒ«åã®è¡¨ç¤ºç®¡ç†
        function showControlsAndFilename() {
            if (isYouTubeMode) {
                showYouTubeControls();
                return;
            }
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
            clearTimeout(timeout);
            if (!isMouseOverControls) {
                timeout = setTimeout(() => {
                    if (!isMouseOverControls) {
                        controls.style.opacity = '0';
                        filename.style.opacity = '0';
                        overlayDisplay.classList.remove('active');
                        videoContainer.style.cursor = 'none';
                        setTimeout(() => {
                            overlayDisplay.style.display = 'none';
                        }, 300);
                    }
                }, overlayTimeout);
            }
        }

        function hideControlsAndFilename() {
            if (isYouTubeMode) {
                youtubeCloseBtn.style.opacity = '0';
                return;
            }
            controls.style.opacity = '0';
            filename.style.opacity = '0';
            overlayDisplay.classList.remove('active');
            videoContainer.style.cursor = 'none';
            clearTimeout(timeout);
            setTimeout(() => {
                overlayDisplay.style.display = 'none';
            }, 300);
        }

        controls.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(timeout);
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
        });

        controls.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showControlsAndFilename();
        });

        filename.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(timeout);
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
        });

        filename.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showControlsAndFilename();
        });

        // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00:00';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            const currentTime = formatTime(video.currentTime);
            const duration = formatTime(video.duration);
            timeDisplay.textContent = `${currentTime} / ${duration}`;
        }

        function updateVolumeDisplay() {
            const volumePercent = Math.round(video.volume * 100);
            volumeDisplay.textContent = `${volumePercent}%`;
        }

        function updateOverlayDisplay(content, isInitial = false) {
            overlayDisplay.textContent = content;
            const overlayFontSize = parseFloat(overlayDisplay.style.fontSize) || 90;
            const charCount = content.length;
            const charWidth = overlayFontSize * 0.6;
            let overlayWidth = charCount * charWidth + 40;
            overlayWidth = Math.max(200, Math.min(overlayWidth, window.innerWidth * 0.8));
            overlayDisplay.style.width = `${overlayWidth}px`;
            overlayDisplay.style.display = 'block';
            overlayDisplay.classList.add('active');
            if (!isInitial) {
                showControlsAndFilename();
            }
        }

        function hideOverlayDisplay() {
            overlayDisplay.classList.remove('active');
            setTimeout(() => {
                overlayDisplay.style.display = 'none';
            }, 300);
        }

        // å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        video.addEventListener('loadedmetadata', () => {
            seekBar.max = 100;
            updateTimeDisplay();
            updateVolumeDisplay();
            const rawCurrentTime = localStorage.getItem('currentTime');
            const savedCurrentTime = parseFloat(rawCurrentTime);
            if (!isNaN(savedCurrentTime) && savedCurrentTime > 0 && savedCurrentTime <= video.duration) {
                video.currentTime = savedCurrentTime;
                updateTimeDisplay();
                video.play().catch(() => {
                    playPauseBtn.textContent = 'â–¶ï¸';
                    playPauseBtn.setAttribute('data-tooltip', 'å†ç”Ÿï¼ˆSpaceï¼‰');
                });
                playPauseBtn.textContent = 'â¸ï¸';
                playPauseBtn.setAttribute('data-tooltip', 'ä¸€æ™‚åœæ­¢ï¼ˆSpaceï¼‰');
                startPeriodicSave();
                savePlaylistAndPlaybackState();
            } else {
                video.currentTime = 0;
                video.play().catch(() => {
                    playPauseBtn.textContent = 'â–¶ï¸';
                    playPauseBtn.setAttribute('data-tooltip', 'å†ç”Ÿï¼ˆSpaceï¼‰');
                });
                playPauseBtn.textContent = 'â¸ï¸';
                playPauseBtn.setAttribute('data-tooltip', 'ä¸€æ™‚åœæ­¢ï¼ˆSpaceï¼‰');
                startPeriodicSave();
                savePlaylistAndPlaybackState();
            }
        });

        video.addEventListener('error', () => {
            if (video.src && /\.(mp4|mkv|webm)$/i.test(video.src)) {
                stopPeriodicSave();
                playPauseBtn.textContent = 'â–¶ï¸';
                playPauseBtn.setAttribute('data-tooltip', 'å†ç”Ÿï¼ˆSpaceï¼‰');
            }
        });

        video.addEventListener('mousemove', showControlsAndFilename);

        video.addEventListener('click', (event) => {
            event.preventDefault();
            showControlsAndFilename();
        });

        video.addEventListener('dblclick', (event) => {
            event.preventDefault();
            if (!document.fullscreenElement) {
                if (videoContainer.requestFullscreen) {
                    videoContainer.requestFullscreen();
                    fullscreenBtn.textContent = 'âŒ';
                    fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤');
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = 'ğŸ–¥ï¸';
                    fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º');
                }
            }
            showControlsAndFilename();
        });

        video.addEventListener('touchstart', (event) => {
            event.preventDefault({ passive: false });
            isDragging = false;
            touchStartTime = Date.now();
            const currentTime = touchStartTime;
            if (currentTime - lastTouchTime < 400) {
                event.stopPropagation();
                if (!document.fullscreenElement) {
                    if (videoContainer.requestFullscreen) {
                        videoContainer.requestFullscreen();
                        fullscreenBtn.textContent = 'âŒ';
                        fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤');
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        fullscreenBtn.textContent = 'ğŸ–¥ï¸';
                        fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º');
                    }
                }
                showControlsAndFilename();
            } else {
                const touch = event.touches[0];
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                wasPlaying = !video.paused;
                lastTouchTime = currentTime;
            }
        }, { passive: false });

        video.addEventListener('touchmove', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault({ passive: false });
            const touch = event.touches[0];
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);

            if (absDeltaX > 5 || absDeltaY > 5) {
                isDragging = true;
            }

            if (isDragging && video.duration) {
                if (absDeltaX > absDeltaY && absDeltaX > 5) {
                    isVolumeDragging = false;
                    const seekStep = video.duration / 1000;
                    const seekTime = deltaX * seekStep * seekSensitivity;
                    let newTime = video.currentTime + seekTime;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`ğŸ•“ ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                } else if (absDeltaY > absDeltaX && absDeltaY > 5) {
                    isVolumeDragging = true;
                    const newVolume = video.volume - (deltaY * volumeStep);
                    video.volume = Math.max(0, Math.min(1, newVolume));
                    volumeBar.value = video.volume;
                    lastVolume = video.volume;
                    volumeMuteBtn.textContent = video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
                    volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
                    updateVolumeDisplay();
                    updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
                    localStorage.setItem('volume', video.volume);
                }
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                showControlsAndFilename();
            }
        }, { passive: false });

        video.addEventListener('touchend', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault({ passive: false });
            event.stopPropagation();
            const touchEndTime = Date.now();
            const touch = event.changedTouches[0];
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);
            const touchDuration = touchEndTime - touchStartTime;

            if (!isDragging && touchDuration < 750 && absDeltaX < 15 && absDeltaY < 15) {
                if (controls.style.opacity === '1') {
                    isMouseOverControls = false;
                    hideControlsAndFilename();
                } else {
                    showControlsAndFilename();
                }
            } else if (isDragging) {
                isDragging = false;
                isVolumeDragging = false;
                showControlsAndFilename();
            }
        }, { passive: false });

        video.addEventListener('mousedown', (event) => {
            if (isYouTubeMode) return;
            if (event.button === 0) {
                isDragging = true;
                dragStartX = event.clientX;
                dragStartY = event.clientY;
                wasPlaying = !video.paused;
                event.preventDefault();
            }
        });

        video.addEventListener('mousemove', (event) => {
            if (isYouTubeMode) return;
            if (isDragging && video.duration) {
                const deltaX = event.clientX - dragStartX;
                const deltaY = event.clientY - dragStartY;
                const absDeltaX = Math.abs(deltaX);
                const absDeltaY = Math.abs(deltaY);

                if (absDeltaX > absDeltaY && absDeltaX > 5) {
                    isVolumeDragging = false;
                    const seekStep = video.duration / 1000;
                    const seekTime = deltaX * seekStep * seekSensitivity;
                    let newTime = video.currentTime + seekTime;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`ğŸ•“ ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                } else if (absDeltaY > absDeltaX && absDeltaY > 5) {
                    isVolumeDragging = true;
                    const newVolume = video.volume - (deltaY * volumeStep);
                    video.volume = Math.max(0, Math.min(1, newVolume));
                    volumeBar.value = video.volume;
                    lastVolume = video.volume;
                    volumeMuteBtn.textContent = video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
                    volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
                    updateVolumeDisplay();
                    updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
                    localStorage.setItem('volume', video.volume);
                }

                dragStartX = event.clientX;
                dragStartY = event.clientY;
                showControlsAndFilename();
            }
        });

        video.addEventListener('mouseup', () => {
            if (isYouTubeMode) return;
            isDragging = false;
            isVolumeDragging = false;
            showControlsAndFilename();
        });

        video.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            isDragging = false;
            isVolumeDragging = false;
            showControlsAndFilename();
        });

        seekBar.addEventListener('mousemove', (e) => {
            if (isYouTubeMode) return;
            e.stopPropagation();
            if (video.duration) {
                const rect = seekBar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                if (x >= 0 && x <= rect.width) {
                    const time = video.duration * (x / rect.width);
                    updateOverlayDisplay(`ğŸ•“ ${formatTime(time)}`);
                }
                showControlsAndFilename();
            }
        });

        seekBar.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            if (!isDragging && !seekBar.matches(':active')) {
                hideOverlayDisplay();
            }
        });

        volumeBar.addEventListener('mousemove', (e) => {
            if (isYouTubeMode) return;
            e.stopPropagation();
            const rect = volumeBar.getBoundingClientRect();
            const x = e.clientX - rect.left;
            if (x >= 0 && x <= rect.width) {
                const volume = (x / rect.width);
                const volumePercent = Math.round(volume * 100);
                updateOverlayDisplay(`${volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${volumePercent}%`);
            }
            showControlsAndFilename();
        });

        volumeBar.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            if (!isVolumeDragging && !volumeBar.matches(':active')) {
                hideOverlayDisplay();
            }
        });

        sizeSelect.addEventListener('change', () => {
            const value = parseInt(sizeSelect.value);
            localStorage.setItem('controlSize', value);
            updateControlSize(value);
            showControlsAndFilename();
        });

        video.addEventListener('timeupdate', () => {
            if (isYouTubeMode) return;
            if (!isDragging && !seekBar.matches(':active')) {
                const value = (100 / video.duration) * video.currentTime;
                seekBar.value = value;
                updateTimeDisplay();
            }
        });

        function updatePlaylistDisplay() {
            filenameDisplay.innerHTML = '';
            if (playlist.length === 0) {
                const savedPlaylist = localStorage.getItem('playlist');
                if (savedPlaylist) {
                    try {
                        const parsedPlaylist = JSON.parse(savedPlaylist);
                        if (Array.isArray(parsedPlaylist) && parsedPlaylist.length > 0) {
		                    filenameDisplay.innerHTML = `<option value="">å†ç”Ÿé€”ä¸­:â–¶ï¸ ${parsedPlaylist[parsedCurrentVideoIndex]}</option>`;
                        } else {
                            filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                        }
                    } catch (e) {
                        filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                    }
                } else {
                    filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                }
                return;
            }
            playlist.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = (index === currentVideoIndex ? 'â–¶ï¸ ' : '') + item.name;
                filenameDisplay.appendChild(option);
            });
            filenameDisplay.value = currentVideoIndex;
        }

        filenameDisplay.addEventListener('change', () => {
            if (isYouTubeMode) return;
            const selectedIndex = parseInt(filenameDisplay.value);
            if (!isNaN(selectedIndex)) {
                currentVideoIndex = selectedIndex;
                localStorage.setItem('currentTime', 0);
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
        });

        hiddenFolderInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length === 0) return;
            playlist = [];
            const savedPlaylist = localStorage.getItem('playlist');
            let parsedSavedPlaylist = [];
            if (savedPlaylist) {
                parsedSavedPlaylist = JSON.parse(savedPlaylist);
            }

            for (const file of files) {
                if (file.name.match(/\.(mp4|mkv|webm)$/i)) {
                    playlist.push({ file, name: file.webkitRelativePath || file.name });
                }
            }
            playlist.sort((a, b) => a.name.localeCompare(b.name));

            if (playlist.length > 0) {
                const playlistNames = playlist.map(item => item.name);
                const matchesSavedPlaylist = savedPlaylist && JSON.stringify(playlistNames) === savedPlaylist;
                if (matchesSavedPlaylist && savedCurrentVideoIndex) {
                    currentVideoIndex = Math.min(parseInt(savedCurrentVideoIndex), playlist.length - 1);
                } else {
                    currentVideoIndex = 0;
                    localStorage.setItem('currentTime', 0);
                }
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
            } else {
                filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                appNameAndCopyright.textContent = appNameAndCopyrightValue;
                stopPeriodicSave();
                savePlaylistAndPlaybackState();
            }
        });

        hiddenVideoInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length === 0) return;
            const file = files[0];
            if (file) {
                try {
                    playlist = [{ file, name: file.name }];
                    const savedPlaylist = localStorage.getItem('playlist');
                    let matchesSavedPlaylist = false;
                    if (savedPlaylist) {
                        try {
                            const parsedSavedPlaylist = JSON.parse(savedPlaylist);
                            matchesSavedPlaylist = parsedSavedPlaylist.length === 1 && parsedSavedPlaylist[0] === file.name;
                        } catch (e) {
                            console.error('ä¿å­˜ã•ã‚ŒãŸãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®è§£æã«å¤±æ•—:', e);
                        }
                    }
                    if (matchesSavedPlaylist && savedCurrentVideoIndex) {
                        currentVideoIndex = parseInt(savedCurrentVideoIndex) || 0;
                    } else {
                        currentVideoIndex = 0;
                        localStorage.setItem('currentTime', 0);
                    }
                    updatePlaylistDisplay();
                    playVideo(file);
                } catch (e) {
                    stopPeriodicSave();
                    savePlaylistAndPlaybackState();
                }
            }
        });

        video.addEventListener('ended', () => {
            if (isYouTubeMode) return;
            video.currentTime = 0;
            localStorage.setItem('currentTime', video.currentTime);
            if (currentVideoIndex < playlist.length - 1) {
                currentVideoIndex++;
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
            } else {
                video.src = '';
                savePlaylistAndPlaybackState();
                stopPeriodicSave();
            }
        });

        function playVideo(file) {
            video.src = URL.createObjectURL(file);
            updatePlaylistDisplay();
            const savedVolume = localStorage.getItem('volume');
            if (savedVolume && !isNaN(savedVolume) && savedVolume >= 0 && savedVolume <= 1) {
                video.volume = savedVolume;
                volumeBar.value = savedVolume;
                lastVolume = savedVolume;
                volumeMuteBtn.textContent = savedVolume == 0 ? 'ğŸ”‡' : 'ğŸ”Š';
                volumeMuteBtn.setAttribute('data-tooltip', savedVolume == 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            } else {
                video.volume = volumeBar.value || 0.2;
                lastVolume = video.volume;
                volumeMuteBtn.textContent = 'ğŸ”Š';
                volumeMuteBtn.setAttribute('data-tooltip', 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            }
            updateVolumeDisplay();
            video.load();
            showControlsAndFilename();
        }

        function togglePlayPause() {
            if (isYouTubeMode) return;
            if (video.paused) {
                video.play().catch(() => {
                    playPauseBtn.textContent = 'â–¶ï¸';
                    playPauseBtn.setAttribute('data-tooltip', 'å†ç”Ÿï¼ˆSpaceï¼‰');
                });
                playPauseBtn.textContent = 'â¸ï¸';
                playPauseBtn.setAttribute('data-tooltip', 'ä¸€æ™‚åœæ­¢ï¼ˆSpaceï¼‰');
                startPeriodicSave();
            } else {
                video.pause();
                playPauseBtn.textContent = 'â–¶ï¸';
                playPauseBtn.setAttribute('data-tooltip', 'å†ç”Ÿï¼ˆSpaceï¼‰');
                localStorage.setItem('currentTime', video.currentTime);
                stopPeriodicSave();
            }
            showControlsAndFilename();
        }

        playPauseBtn.addEventListener('click', togglePlayPause);

        video.addEventListener('contextmenu', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault();
            event.stopPropagation();
            togglePlayPause();
        });

        prevVideoBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
            showControlsAndFilename();
        });

        rewindBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.duration) {
                wasPlaying = !video.paused;
                let newTime = video.currentTime - 30;
                newTime = Math.max(0, newTime);
                video.currentTime = newTime;
                seekBar.value = (100 / video.duration) * newTime;
                updateTimeDisplay();
                updateOverlayDisplay(`ğŸ•“ ${formatTime(newTime)}`);
                localStorage.setItem('currentTime', newTime);
                showControlsAndFilename();
            }
        });

        fastForwardBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.duration) {
                wasPlaying = !video.paused;
                let newTime = video.currentTime + 30;
                newTime = Math.min(video.duration, newTime);
                video.currentTime = newTime;
                seekBar.value = (100 / video.duration) * newTime;
                updateTimeDisplay();
                updateOverlayDisplay(`ğŸ•“ ${formatTime(newTime)}`);
                localStorage.setItem('currentTime', newTime);
                showControlsAndFilename();
            }
        });

        nextVideoBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (currentVideoIndex < playlist.length - 1) {
                currentVideoIndex++;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
            showControlsAndFilename();
        });

        video.addEventListener('wheel', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault();
            const volumeStep = 0.05;
            if (event.deltaY < 0) {
                video.volume = Math.min(1, video.volume + volumeStep);
            } else if (event.deltaY > 0) {
                video.volume = Math.max(0, video.volume - volumeStep);
            }
            volumeBar.value = video.volume;
            lastVolume = video.volume;
            volumeMuteBtn.textContent = video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
            volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
            showControlsAndFilename();
        });

        seekBar.addEventListener('input', () => {
            if (isYouTubeMode) return;
            wasPlaying = !video.paused;
            const time = video.duration * (seekBar.value / 100);
            video.currentTime = time;
            updateTimeDisplay();
            updateOverlayDisplay(`ğŸ•“ ${formatTime(time)}`);
            localStorage.setItem('currentTime', time);
        });

        volumeMuteBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.volume === 0) {
                video.volume = lastVolume || 0.2;
                volumeBar.value = video.volume;
                volumeMuteBtn.textContent = 'ğŸ”Š';
                volumeMuteBtn.setAttribute('data-tooltip', 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            } else {
                lastVolume = video.volume;
                video.volume = 0;
                volumeBar.value = 0;
                volumeMuteBtn.textContent = 'ğŸ”‡';
                volumeMuteBtn.setAttribute('data-tooltip', 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤');
            }
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
        });

        volumeBar.addEventListener('input', () => {
            if (isYouTubeMode) return;
            video.volume = volumeBar.value;
            lastVolume = video.volume;
            volumeMuteBtn.textContent = video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
            volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
        });

        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                if (videoContainer.requestFullscreen) {
                    videoContainer.requestFullscreen();
                    fullscreenBtn.textContent = 'âŒ';
                    fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤');
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = 'ğŸ–¥ï¸';
                    fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º');
                }
            }
            showControlsAndFilename();
        });

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                fullscreenBtn.textContent = 'ğŸ–¥ï¸';
                fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º');
            } else {
                fullscreenBtn.textContent = 'âŒ';
                fullscreenBtn.setAttribute('data-tooltip', 'ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è§£é™¤');
            }
        });

        document.addEventListener('keydown', (event) => {
            if (isYouTubeMode) return;
            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                if (video.duration) {
                    wasPlaying = !video.paused;
                    const delta = event.key === 'ArrowLeft' ? -5 : 5;
                    let newTime = video.currentTime + delta;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`ğŸ•“ ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                    showControlsAndFilename();
                }
            } else if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                const delta = event.key === 'ArrowUp' ? 0.05 : -0.05;
                video.volume = Math.max(0, Math.min(1, video.volume + delta));
                volumeBar.value = video.volume;
                lastVolume = video.volume;
                volumeMuteBtn.textContent = video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
                volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤' : 'ãƒŸãƒ¥ãƒ¼ãƒˆ');
                updateVolumeDisplay();
                updateOverlayDisplay(`${video.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š'} ${Math.round(video.volume * 100)}%`);
                localStorage.setItem('volume', video.volume);
                showControlsAndFilename();
            } else if (event.key === ' ') {
                event.preventDefault();
                togglePlayPause();
            } else if (event.key === 'PageUp' && playlist.length > 0) {
                if (currentVideoIndex > 0) {
                    currentVideoIndex--;
                    localStorage.setItem('currentTime', 0);
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                    showControlsAndFilename();
                }
            } else if (event.key === 'PageDown' && playlist.length > 0) {
                if (currentVideoIndex < playlist.length - 1) {
                    currentVideoIndex++;
                    localStorage.setItem('currentTime', 0);
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                    showControlsAndFilename();
                }
            } else if (event.key === 'Home' && playlist.length > 0) {
                currentVideoIndex = 0;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
                showControlsAndFilename();
            } else if (event.key === 'End' && playlist.length > 0) {
                currentVideoIndex = playlist.length - 1;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
                showControlsAndFilename();
            }
        });
    </script>
</body>
</html>