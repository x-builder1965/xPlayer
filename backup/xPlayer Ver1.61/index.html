<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xPlayer -ÂãïÁîª„Éó„É¨„Ç§„É§„Éº-</title>
    <link rel="icon" type="image/x-icon" href="xPlayer.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #1c2526;
            color: #ffffff;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }
        .video-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: auto;
        }
        video {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
            border: none;
            touch-action: none;
        }
        iframe#youtubePlayer {
            width: 100vw;
            height: 100vh;
            border: none;
            display: none;
        }
        .filename,
        .controls {
            position: absolute;
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            transition: opacity 0.3s ease;
        }
        .filename {
            top: 20px;
        }
        .controls {
            bottom: 20px;
        }
        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .left-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 6px 12px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            min-width: 40px;
            position: relative;
        }
        button:hover {
            background-color: #0056b3;
        }
        button#folderInput.resume-active,
        button#videoInput.resume-active {
            background-color: #ff0000;
        }
        button#folderInput.resume-active:hover,
        button#videoInput.resume-active:hover {
            background-color: #cc0000;
        }
        input[type="range"] {
            flex: 1;
            accent-color: #007bff;
            height: 8px;
            background: #555;
            border-radius: 5px;
            outline: none;
            position: relative;
        }
        input[type="range"]:hover {
            accent-color: #ff0000;
        }
        input[type="range"]#volumeBar {
            flex: none;
            width: 10%;
        }
        #seekBar:hover,
        #volumeBar:hover {
            background: rgba(0, 123, 255, 0.2);
            cursor: pointer;
        }
        #seekBar::-webkit-slider-thumb,
        #volumeBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
        }
        #seekBar:hover::-webkit-slider-thumb,
        #volumeBar:hover::-webkit-slider-thumb {
            background: #ff0000;
            transform: scale(1.5);
        }
        #seekBar::-moz-range-thumb,
        #volumeBar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007bff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }
        #seekBar:hover::-moz-range-thumb,
        #volumeBar:hover::-moz-range-thumb {
            background: #ff0000;
            transform: scale(1.5);
        }
        input[type="file"] {
            display: none;
        }
        input#urlInput {
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 16px;
            width: 90%;
            display: none;
        }
        select#filenameDisplay,
        select#sizeSelect {
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 16px;
            box-sizing: border-box;
            cursor: pointer;
            position: relative;
        }
        select#filenameDisplay {
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        select#sizeSelect {
            width: 100px;
        }
        select#filenameDisplay option,
        select#sizeSelect option {
            background: #1c2526;
            color: #ffffff;
        }
        #timeDisplay, #volumeDisplay {
            color: #ffffff;
            font-size: 16px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }
        .spacer {
            min-width: 10px;
        }
        #overlayDisplay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.5);
            color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            transition: opacity 0.3s ease;
            opacity: 0;
            pointer-events: none;
            text-align: center;
            white-space: normal;
            word-wrap: break-word;
            max-width: 80vw;
        }
        #overlayDisplay.active {
            opacity: 1;
        }
        .app-name-and-copyright {
            margin-left: auto;
            color: #ffffff;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 5px;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #ffffff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        .tooltip.visible {
            opacity: 1;
        }
        button:hover .tooltip,
        input[type="range"]:hover .tooltip,
        input#urlInput:hover .tooltip,
        select:hover .tooltip {
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        #youtubeCloseBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: none;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        .url-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="videoPlayer" src=""></video>
        <iframe id="youtubePlayer" src="" allow="autoplay; fullscreen" allowfullscreen></iframe>
        <div class="filename">
            <select id="filenameDisplay" data-tooltip="ÂÜçÁîüÂãïÁîª„É™„Çπ„Éà">
                <option value=""></option>
            </select>
            <div class="url-controls">
                <input id="urlInput" type="text" placeholder="YouTube URL„ÇíÂÖ•Âäõ" data-tooltip="YouTube URL„ÇíÂÖ•Âäõ">
                <button id="urlConfirmBtn" data-tooltip="URLÂÜçÁîü">‚úÖ</button>
                <button id="urlCancelBtn" data-tooltip="„Ç≠„É£„É≥„Çª„É´">‚ùå</button>
            </div>
        </div>
        <div id="overlayDisplay"></div>
        <div class="controls">
            <div class="control-row">
                <div class="left-controls">
                    <button id="folderInput" data-tooltip="„Éï„Ç©„É´„ÉÄÈÅ∏Êäû">üìÅ</button>
                    <button id="videoInput" data-tooltip="„Éï„Ç°„Ç§„É´ÈÅ∏Êäû">üóíÔ∏è</button>
                    <button id="urlInputBtn" data-tooltip="„Éç„ÉÉ„ÉàÂãïÁîªÈÅ∏Êäû">üåê</button>
                    <span class="spacer"></span>
                    <button id="prevVideoBtn" data-tooltip="Ââç„ÅÆÂãïÁîª„Å∏ÔºàPgUpÔºâ">‚èÆÔ∏è</button>
                    <button id="rewindBtn" data-tooltip="30ÁßíÊàª„ÇãÔºà‚ÜêÔºèSwipe LeftÔºâ">‚è™</button>
                    <button id="playPauseBtn" data-tooltip="ÂÜçÁîüÔºàSpaceÔºâ">‚ñ∂Ô∏è</button>
                    <button id="fastForwardBtn" data-tooltip="30ÁßíÈÄ≤„ÇÄÔºà‚ÜíÔºèSwipe RightÔºâ">‚è©</button>
                    <button id="nextVideoBtn" data-tooltip="Ê¨°„ÅÆÂãïÁîª„Å∏ÔºàPgDwÔºâ">‚è≠Ô∏è</button>
                    <span class="spacer"></span>
                    <button id="fitModeBtn" data-tooltip="Ê®™„Å´Âêà„Çè„Åõ„Çã">‚ÜïÔ∏è</button>
                    <select id="sizeSelect" data-tooltip="„Çµ„Ç§„Ç∫Â§âÊõ¥">
                        <option value="10">10%</option>
                        <option value="25">25%</option>
                        <option value="50" selected>50%</option>
                        <option value="75">75%</option>
                        <option value="100">100%</option>
                    </select>
                    <button id="fullscreenBtn" data-tooltip="„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫">üñ•Ô∏è</button>
                </div>
                <label class="app-name-and-copyright" id="appNameAndCopyright" data-tooltip="„Ç¢„Éó„É™ÊÉÖÂ†±"></label>
            </div>
            <div class="control-row">
                <button id="volumeMuteBtn" data-tooltip="„Éü„É•„Éº„Éà/„Éü„É•„Éº„ÉàËß£Èô§">üîä</button>
                <span id="volumeDisplay" data-tooltip="Èü≥ÈáèÔºà‚Üë‚ÜìÔºèSwipe Up DownÔºâ">20%</span>
                <input type="range" id="volumeBar" value="0.2" min="0" max="1" step="0.01" data-tooltip="Èü≥ÈáèÂ§âÊõ¥Ôºà‚Üë‚ÜìÔºèSwipe Up DownÔºâ">
                <span id="timeDisplay" data-tooltip="ÂÜçÁîüÊôÇÈñì/ÂãïÁîªÊôÇÈñìÔºà‚Üê‚ÜíÔºèSwipe Left RightÔºâ">0:00:00 / 0:00:00</span>
                <input type="range" id="seekBar" value="0" min="0" max="100" data-tooltip="ÂÜçÁîü‰ΩçÁΩÆÂ§âÊõ¥Ôºà‚Üê‚ÜíÔºèSwipe Left RightÔºâ">
            </div>
        </div>
        <button id="youtubeCloseBtn" data-tooltip="„Éç„ÉÉ„ÉàÂãïÁîªÂÜçÁîüÁµÇ‰∫Ü">‚ùå</button>
    </div>

    <script>
        // ---------------------------------------------------------------------
        const copyright = 'Copyright ¬© 2025 @x-builder, Japan';
        const email = 'x-builder@gmail.com';
        const appName = 'xPlayer -ÂãïÁîª„Éó„É¨„Ç§„É§„Éº- Ver2.05';
        // ---------------------------------------------------------------------
        // [Â§âÊõ¥Â±•Ê≠¥]
        // 2025-10-24 Ver2.00 ÔºàWindowsÁâàÔºâ„ÅÆÈñãÁô∫
        //    „ÉªfolderInput„ÄÅvideoInput„ÅÆWindows API„ÉÄ„Ç§„Ç¢„É≠„Ç∞ÂØæÂøúÔºànode.js‰ΩøÁî®Ôºâ
        //    „ÉªfolderInput„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÈöéÂ±§„Éï„Ç©„É´„ÉÄË™≠ËæºÂØæÂøúÔºànode.js‰ΩøÁî®Ôºâ
        //    „ÉªfolderInput„ÄÅvideoInput„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆ„Éó„É¨„Ç§„É™„Çπ„Éà„Éï„Ç°„Ç§„É´Ôºà.ampplÔºâ„ÅÆË™≠ËæºÂØæÂøúÔºànode.js‰ΩøÁî®Ôºâ
        //    „ÉªfilenameDisplay„Å´ÂãïÁîª„Éï„Ç°„Ç§„É´„ÅÆ„Éï„É´„Éë„Çπ„ÇíË°®Á§∫
        // 2025-10-24 Ver2.01 Ëµ∑ÂãïÔºà„É™„É≠„Éº„ÉâÔºâÊôÇ„ÄÅÂâçÂõû„ÅÆÂãïÁîª„Éï„Ç°„Ç§„É´„ÄÅÊôÇÈñì„ÅßÂÜçÈñã„Åï„Çå„Å™„ÅÑ„ÄÇ
        // 2025-10-24 Ver2.02 ÂÜçÈñãÂØæË±°„Éú„Çø„É≥„ÅÆÂà§ÂÆöÊñπÊ≥ï„ÅÆÂ§âÊõ¥
        //    „ÉªÂ§âÊõ¥ÂâçÔºö„Éó„É¨„Ç§„É™„Çπ„ÉàÂÜÖ„ÅÆ‰ª∂Êï∞„Åå1‰ª∂„ÅÆÂ†¥ÂêàvideoInput„ÄÅ2‰ª∂‰ª•‰∏ä„ÅÆÂ†¥ÂêàfolderInput
        //    „ÉªÂ§âÊõ¥ÂæåÔºöÈÅ∏Êäû„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´localStorage„Å´ÈÅ∏Êäû„Éú„Çø„É≥ÔºàvideoInput„ÄÅfolderInputÔºâ„Çí‰øùÂ≠ò„ÄÅÂà§ÂÆöÊôÇ„Å´localStorage„Åã„ÇâÈÅ∏Êäû„Éú„Çø„É≥„ÇíÂèñÂæó
        // 2025-10-24 Ver2.03 „Éç„ÉÉ„ÉàÂãïÁîªÂÜçÁîüÊôÇ„ÄÅvolumeBar„ÄÅvolumeMuteBtn„ÅÆÁä∂ÊÖã„ÇíÂèçÊò†„ÄÇ
        // 2025-10-24 Ver2.04 „Éç„ÉÉ„ÉàÂãïÁîªÂÜçÁîü‰∏≠„ÄÅoverlayDisplay„ÇíÈùûË°®Á§∫„ÄÇ
        // 2025-10-24 Ver2.05 YouTubeÂãïÁîªÂÜçÁîüÊôÇ„Å´Áô∫Áîü„Åô„Çã153„Ç®„É©„Éº„Å´ÂØæÂøú„ÄÇÔºàÂÜçÁîüÊôÇ„ÅÆ„Éú„É™„É•„Éº„É†Èáè„ÄÅ„Éü„É•„Éº„ÉàÁä∂ÊÖã„Å™„Å©„ÅÆÊåáÂÆöÂâäÈô§Ôºâ
        // ---------------------------------------------------------------------

        // [ËøΩÂä†] Electron„ÅÆipcRenderer„Çí„Ç§„É≥„Éù„Éº„Éà
        const { ipcRenderer } = require('electron');

        // Ë°®Á§∫„Ç´„Çπ„Çø„Éû„Ç§„Ç∫
        const overlayTimeout = 3000;
        const seekSensitivity = 0.3;
        const volumeStep = 0.005;
        const appNameAndCopyrightValue = `${appName}„ÄÄ„ÄÄ${copyright}`;

        const video = document.getElementById('videoPlayer');
        const youtubePlayer = document.getElementById('youtubePlayer');
        const videoContainer = document.querySelector('.video-container');
        const controls = document.querySelector('.controls');
        const folderInput = document.getElementById('folderInput');
        const videoInput = document.getElementById('videoInput');
        const urlInputBtn = document.getElementById('urlInputBtn');
        const urlInput = document.getElementById('urlInput');
        const urlConfirmBtn = document.getElementById('urlConfirmBtn');
        const urlCancelBtn = document.getElementById('urlCancelBtn');
        const urlControls = document.querySelector('.url-controls');
        const youtubeCloseBtn = document.getElementById('youtubeCloseBtn');
        const hiddenFolderInput = document.getElementById('hiddenFolderInput');
        const hiddenVideoInput = document.getElementById('hiddenVideoInput');
        const prevVideoBtn = document.getElementById('prevVideoBtn');
        const rewindBtn = document.getElementById('rewindBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const fastForwardBtn = document.getElementById('fastForwardBtn');
        const nextVideoBtn = document.getElementById('nextVideoBtn');
        const seekBar = document.getElementById('seekBar');
        const volumeMuteBtn = document.getElementById('volumeMuteBtn');
        const volumeBar = document.getElementById('volumeBar');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const sizeSelect = document.getElementById('sizeSelect');
        const fitModeBtn = document.getElementById('fitModeBtn');
        const filename = document.querySelector('.filename');
        const filenameDisplay = document.getElementById('filenameDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const volumeDisplay = document.getElementById('volumeDisplay');
        const overlayDisplay = document.getElementById('overlayDisplay');
        const appNameAndCopyright = document.getElementById('appNameAndCopyright');
        const savedInputType = localStorage.getItem('inputType');

        let playlist = [];
        let currentVideoIndex = 0;
        let timeout;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let touchStartTime = 0;
        let lastTouchTime = 0;
        let isVolumeDragging = false;
        let lastVolume = 0.2;
        let wasPlaying = false;
        let isMouseOverControls = false;
        let isInitialLoad = true;
        let saveInterval = null;
        let fitMode = 'contain';
        let isYouTubeMode = false;
        let controlTimeout;

        // „Éá„Éê„Ç§„ÇπÂà§Âà•Ôºà„Çπ„Éû„ÉõÊ§úÁü•Ôºâ
        function isMobileDevice() {
            return navigator.maxTouchPoints > 0 || window.matchMedia("(pointer: coarse)").matches;
        }

        // ÁîªÈù¢„Çµ„Ç§„Ç∫„Å´Âü∫„Å•„Åè„Ç≥„É≥„Éà„É≠„Éº„É´„Çµ„Ç§„Ç∫„ÅÆË®àÁÆó
        function calculateControlSize() {
            const screenWidth = window.innerWidth;
            let sizePercent;
            if (screenWidth <= 480) {
                sizePercent = 10;
            } else if (screenWidth <= 768) {
                sizePercent = 25;
            } else if (screenWidth <= 1200) {
                sizePercent = 50;
            } else if (screenWidth <= 1700) {
                sizePercent = 75;
            } else {
                sizePercent = 100;
            }
            return sizePercent;
        }

        // „Ç≥„É≥„Éà„É≠„Éº„É´„Çµ„Ç§„Ç∫„ÅÆÊõ¥Êñ∞
        function updateControlSize(value, isInitial = false) {
            const fontSize = 8 + (value / 100) * (24 - 8);
            const padding = 2 + (value / 100) * (10 - 2);
            const appNameAndCopyrightFontSize = 8 + (value / 100) * (17 - 8);
            const appNameAndCopyrightPadding = 2 + (value / 100) * (8 - 2);
            const sizeSelectWidth = 40 + (value / 100) * (124 - 40);
            const controls = document.querySelectorAll('button, select#filenameDisplay, select#sizeSelect, #timeDisplay, #volumeDisplay, #appNameAndCopyright, input#urlInput');
            controls.forEach(control => {
                if (control.id === 'appNameAndCopyright') {
                    control.style.fontSize = `${appNameAndCopyrightFontSize}px`;
                    control.style.padding = `${appNameAndCopyrightPadding}px ${appNameAndCopyrightPadding * 2}px`;
                } else {
                    control.style.fontSize = `${fontSize}px`;
                    control.style.padding = `${padding}px ${padding * 2}px`;
                }
                if (control.id === 'sizeSelect') {
                    control.style.width = `${sizeSelectWidth}px`;
                }
            });

            const overlayFontSize = 20 + (value / 100) * (160 - 20);
            overlayDisplay.style.fontSize = `${overlayFontSize}px`;
            if (!isInitial) {
                updateOverlayDisplay(`üñåÔ∏è ${value}%`);
            }
            isInitialLoad = false;
        }

        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÊôÇ„Å´„Ç≥„É≥„Éà„É≠„Éº„É´„Çµ„Ç§„Ç∫„ÇíËá™ÂãïË™øÊï¥
        window.addEventListener('resize', () => {
            const autoSize = calculateControlSize();
            sizeSelect.value = autoSize;
            localStorage.setItem('controlSize', autoSize);
            updateControlSize(autoSize);
            showControlsAndFilename();
        });

        // ÂàùÊúüÁä∂ÊÖã„Åßvideo.src„ÇíÊòéÁ§∫ÁöÑ„Å´Á©∫„Å´Ë®≠ÂÆö
        video.src = '';

        // Ë°®Á§∫„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ÈÅ©Áî®
        appNameAndCopyright.textContent = appNameAndCopyrightValue;

        // ÂàùÊúüÁä∂ÊÖã„Åß„Éó„É¨„Ç§„É™„Çπ„Éà„Å´appNameAndCopyright„ÇíË®≠ÂÆö
        filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;

        // localStorage„Åã„ÇâÂæ©ÂÖÉ
        const savedControlSize = localStorage.getItem('controlSize');
        const savedVolume = localStorage.getItem('volume');
        const savedPlaylist = localStorage.getItem('playlist');
        const savedCurrentVideoIndex = localStorage.getItem('currentVideoIndex');
        const savedCurrentTime = localStorage.getItem('currentTime');
        const savedFitMode = localStorage.getItem('fitMode');

        let initialControlSize = savedControlSize && ['10', '25', '50', '75', '100'].includes(savedControlSize)
            ? parseInt(savedControlSize)
            : calculateControlSize();
        sizeSelect.value = initialControlSize;
        updateControlSize(initialControlSize, true);

        if (savedVolume && !isNaN(savedVolume) && savedVolume >= 0 && savedVolume <= 1) {
            volumeBar.value = savedVolume;
            video.volume = savedVolume;
            lastVolume = savedVolume;
            volumeMuteBtn.textContent = savedVolume == 0 ? 'üîá' : 'üîä';
            volumeMuteBtn.setAttribute('data-tooltip', savedVolume == 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
            updateVolumeDisplay();
        } else {
            volumeBar.value = 0.2;
            video.volume = 0.2;
            lastVolume = 0.2;
            volumeMuteBtn.textContent = 'üîä';
            volumeMuteBtn.setAttribute('data-tooltip', '„Éü„É•„Éº„Éà');
            updateVolumeDisplay();
        }

        if (savedFitMode && ['contain', 'cover'].includes(savedFitMode)) {
            fitMode = savedFitMode;
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = fitMode === 'contain' ? '‚ÜïÔ∏è' : '‚ÜîÔ∏è';
            fitModeBtn.setAttribute('data-tooltip', fitMode === 'contain' ? 'Ê®™„Å´Âêà„Çè„Åõ„Çã' : 'Á∏¶„Å´Âêà„Çè„Åõ„Çã');
        } else {
            fitMode = 'contain';
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = '‚ÜïÔ∏è';
            fitModeBtn.setAttribute('data-tooltip', 'Ê®™„Å´Âêà„Çè„Åõ„Çã');
        }

        // [Â§âÊõ¥] Ver2.02: localStorage„Åã„Çâ„ÅÆÂæ©ÂÖÉ„É≠„Ç∏„ÉÉ„ÇØ
        let isResumeAvailable = false;
        if (savedPlaylist && savedCurrentVideoIndex && savedCurrentTime && savedInputType) {
            try {
                const parsedPlaylist = JSON.parse(savedPlaylist);
                const parsedCurrentVideoIndex = parseInt(savedCurrentVideoIndex);
                if (Array.isArray(parsedPlaylist) && parsedPlaylist.length > 0 && parsedCurrentVideoIndex >= 0 && parsedCurrentVideoIndex < parsedPlaylist.length) {
                    filenameDisplay.innerHTML = `<option value="">ÂÜçÁîüÈÄî‰∏≠:‚ñ∂Ô∏è ${parsedPlaylist[parsedCurrentVideoIndex]}</option>`;
                    currentVideoIndex = parsedCurrentVideoIndex;
                    // [Â§âÊõ¥] Ver2.02: inputType„Å´Âü∫„Å•„ÅÑ„Å¶resume-active„ÇíË®≠ÂÆö
                    if (savedInputType === 'videoInput') {
                        videoInput.classList.add('resume-active');
                        isResumeAvailable = true;
                    } else if (savedInputType === 'folderInput') {
                        folderInput.classList.add('resume-active');
                        isResumeAvailable = true;
                    }
                } else {
                    filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                }
            } catch (e) {
                filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
            }
        } else {
            filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
        }

        // ÂÆöÊúü‰øùÂ≠ò
        function startPeriodicSave() {
            if (saveInterval) clearInterval(saveInterval);
            saveInterval = setInterval(() => {
                if (!video.paused && playlist.length > 0 && !isYouTubeMode) {
                    localStorage.setItem('currentTime', video.currentTime);
                }
            }, 1000);
        }

        function stopPeriodicSave() {
            if (saveInterval) {
                clearInterval(saveInterval);
                saveInterval = null;
            }
        }

        // [Â§âÊõ¥] Ver2.02: „Éó„É¨„Ç§„É™„Çπ„Éà„Å®ÂÜçÁîüÁä∂ÊÖã„ÅÆ‰øùÂ≠òÔºàinputTypeÂØæÂøúÔºâ
        function savePlaylistAndPlaybackState() {
            if (playlist.length > 0 && !isYouTubeMode) {
                const playlistPaths = playlist.map(item => item.file.path);
                localStorage.setItem('playlist', JSON.stringify(playlistPaths));
                localStorage.setItem('currentVideoIndex', currentVideoIndex);
                localStorage.setItem('currentTime', video.currentTime || 0);
            } else {
                localStorage.removeItem('playlist');
                localStorage.removeItem('currentVideoIndex');
                localStorage.removeItem('currentTime');
                localStorage.removeItem('inputType'); // [ËøΩÂä†] Ver2.02: inputTypeÂâäÈô§
            }
        }

        // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÈñ¢ÈÄ£
        function showTooltip(element) {
            if (isMobileDevice()) return;
            if (element.dataset.tooltip) {
                let tooltip = element.querySelector('.tooltip');
                if (!tooltip) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = element.dataset.tooltip;
                    element.appendChild(tooltip);
                }
                tooltip.classList.add('visible');
            }
        }

        function hideTooltip(element) {
            if (isMobileDevice()) return;
            const tooltip = element.querySelector('.tooltip');
            if (tooltip) {
                tooltip.classList.remove('visible');
            }
        }

        const tooltipElements = document.querySelectorAll('[data-tooltip]');
        tooltipElements.forEach(element => {
            element.addEventListener('mouseenter', () => showTooltip(element));
            element.addEventListener('mouseleave', () => hideTooltip(element));
        });

        // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ
        // [Â§âÊõ¥] Ver2.02: „Éï„Ç©„É´„ÉÄÈÅ∏ÊäûÔºàinputType‰øùÂ≠òÔºâ
        folderInput.addEventListener('click', async () => {
            hideOverlayDisplay();
            try {
                const videoFiles = await ipcRenderer.invoke('open-folder-dialog');
                if (videoFiles.length > 0) {
                    folderInput.classList.remove('resume-active');
                    videoInput.classList.remove('resume-active');
                    localStorage.setItem('inputType', 'folderInput'); // [ËøΩÂä†] Ver2.02: inputType‰øùÂ≠ò
                    playlist = videoFiles.map(file => ({
                        file: { path: file.path },
                        name: file.path
                    }));
                    playlist.sort((a, b) => a.name.localeCompare(b.name));
        
                    // ‰øùÂ≠ò„Åï„Çå„Åü„Éó„É¨„Ç§„É™„Çπ„Éà„Å®ÊØîËºÉ„Åó„Å¶ÂÜçÈñãÂèØËÉΩ„ÅãÂà§ÂÆö
                    const savedPlaylist = localStorage.getItem('playlist');
                    const savedCurrentVideoIndex = parseInt(localStorage.getItem('currentVideoIndex'));
                    const savedCurrentTime = parseFloat(localStorage.getItem('currentTime'));
                    let isResumePossible = false;
        
                    if (savedPlaylist && !isNaN(savedCurrentVideoIndex) && !isNaN(savedCurrentTime)) {
                        try {
                            const parsedPlaylist = JSON.parse(savedPlaylist);
                            // ÈÅ∏Êäû„Åó„Åü„Éï„Ç©„É´„ÉÄ„ÅÆÂãïÁîª„É™„Çπ„Éà„Åå‰øùÂ≠ò„Åï„Çå„Åü„Éó„É¨„Ç§„É™„Çπ„Éà„Å®‰∏ÄËá¥„Åô„Çã„ÅãÁ¢∫Ë™ç
                            const isSamePlaylist = parsedPlaylist.length === playlist.length &&
                                parsedPlaylist.every((path, index) => path === playlist[index].file.path);
                            
                            if (isSamePlaylist && savedCurrentVideoIndex >= 0 && savedCurrentVideoIndex < playlist.length) {
                                currentVideoIndex = savedCurrentVideoIndex;
                                isResumePossible = true;
                            } else {
                                currentVideoIndex = 0;
                                localStorage.setItem('currentTime', 0);
                            }
                        } catch (e) {
                            console.error('„Éó„É¨„Ç§„É™„Çπ„ÉàÊØîËºÉ„Ç®„É©„Éº:', e);
                            currentVideoIndex = 0;
                            localStorage.setItem('currentTime', 0);
                        }
                    } else {
                        currentVideoIndex = 0;
                        localStorage.setItem('currentTime', 0);
                    }
        
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                }
            } catch (e) {
                updateOverlayDisplay('„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Ç®„É©„Éº');
                console.error('„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Ç®„É©„Éº:', e);
            }
        });
        
        // [Â§âÊõ¥] Ver2.02: „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÔºàinputType‰øùÂ≠òÔºâ
        videoInput.addEventListener('click', async () => {
            hideOverlayDisplay();
            try {
                const videoFiles = await ipcRenderer.invoke('open-video-dialog');
                if (videoFiles.length > 0) {
                    folderInput.classList.remove('resume-active');
                    videoInput.classList.remove('resume-active');
                    localStorage.setItem('inputType', 'videoInput'); // [ËøΩÂä†] Ver2.02: inputType‰øùÂ≠ò
                    playlist = videoFiles.map(file => ({
                        file: { path: file.path },
                        name: file.path
                    }));
        
                    // ‰øùÂ≠ò„Åï„Çå„Åü„Éó„É¨„Ç§„É™„Çπ„Éà„Å®ÊØîËºÉ„Åó„Å¶ÂÜçÈñãÂèØËÉΩ„ÅãÂà§ÂÆö
                    const savedPlaylist = localStorage.getItem('playlist');
                    const savedCurrentVideoIndex = parseInt(localStorage.getItem('currentVideoIndex'));
                    const savedCurrentTime = parseFloat(localStorage.getItem('currentTime'));
                    let isResumePossible = false;
        
                    if (savedPlaylist && !isNaN(savedCurrentVideoIndex) && !isNaN(savedCurrentTime)) {
                        try {
                            const parsedPlaylist = JSON.parse(savedPlaylist);
                            // ÈÅ∏Êäû„Åó„ÅüÂãïÁîª„Éï„Ç°„Ç§„É´„Åå‰øùÂ≠ò„Åï„Çå„Åü„Éó„É¨„Ç§„É™„Çπ„Éà„Å®‰∏ÄËá¥„Åô„Çã„ÅãÁ¢∫Ë™ç
                            const isSamePlaylist = parsedPlaylist.length === playlist.length &&
                                parsedPlaylist.every((path, index) => path === playlist[index].file.path);
                            
                            if (isSamePlaylist && savedCurrentVideoIndex >= 0 && savedCurrentVideoIndex < playlist.length) {
                                currentVideoIndex = savedCurrentVideoIndex;
                                isResumePossible = true;
                            } else {
                                currentVideoIndex = 0;
                                localStorage.setItem('currentTime', 0);
                            }
                        } catch (e) {
                            console.error('„Éó„É¨„Ç§„É™„Çπ„ÉàÊØîËºÉ„Ç®„É©„Éº:', e);
                            currentVideoIndex = 0;
                            localStorage.setItem('currentTime', 0);
                        }
                    } else {
                        currentVideoIndex = 0;
                        localStorage.setItem('currentTime', 0);
                    }
        
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                }
            } catch (e) {
                updateOverlayDisplay('„Éï„Ç°„Ç§„É´ÈÅ∏Êäû„Ç®„É©„Éº');
                console.error('„Éï„Ç°„Ç§„É´ÈÅ∏Êäû„Ç®„É©„Éº:', e);
            }
        });

        // [Â§âÊõ¥] ÂÜçÈñã„Éú„Çø„É≥„ÅÆ„Éõ„Éê„Éº„Ç§„Éô„É≥„Éà
        folderInput.addEventListener('mouseenter', () => {
            if (folderInput.classList.contains('resume-active')) {
                updateOverlayDisplay('ÂâçÂõû„Å®Âêå‰∏ÄüìÅ„ÅßÂÜçÈñãÂèØËÉΩ');
            }
        });
        folderInput.addEventListener('mouseleave', () => {
            if (folderInput.classList.contains('resume-active')) {
                hideOverlayDisplay();
            }
        });
        
        videoInput.addEventListener('mouseenter', () => {
            if (videoInput.classList.contains('resume-active')) {
                updateOverlayDisplay('ÂâçÂõû„Å®Âêå‰∏ÄüóíÔ∏è„ÅßÂÜçÈñãÂèØËÉΩ');
            }
        });
        videoInput.addEventListener('mouseleave', () => {
            if (videoInput.classList.contains('resume-active')) {
                hideOverlayDisplay();
            }
        });

        urlInputBtn.addEventListener('click', () => {
            filenameDisplay.style.display = 'none';
            urlControls.style.display = 'flex';
            urlInput.style.display = 'inline-block';
            urlConfirmBtn.style.display = 'inline-block';
            urlCancelBtn.style.display = 'inline-block';
            urlInput.focus();
            showControlsAndFilename();
        });

        urlConfirmBtn.addEventListener('click', () => {
            const url = urlInput.value.trim();
            if (url) {
                const videoId = extractYouTubeVideoId(url);
                if (videoId) {
                    video.pause();
                    isYouTubeMode = true;
                    video.style.display = 'none';
                    youtubePlayer.style.display = 'block';
                    youtubePlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&cc_load_policy=0`;
                    filename.style.display = 'none';
                    controls.style.display = 'none';
                    overlayDisplay.style.display = 'none';
                    overlayDisplay.classList.remove('active');
                    youtubeCloseBtn.style.display = 'block';
                    showYouTubeControls();
                } else {
                    updateOverlayDisplay('ÁÑ°Âäπ„Å™YouTube URL„Åß„Åô');
                }
            }
            hideURLInputControls();
        });

        urlCancelBtn.addEventListener('click', () => {
            hideURLInputControls();
            filenameDisplay.style.display = 'block';
            showControlsAndFilename();
        });

        youtubeCloseBtn.addEventListener('click', () => {
            switchToLocalMode();
        });

        function extractYouTubeVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        function switchToLocalMode() {
            isYouTubeMode = false;
            video.style.display = 'block';
            youtubePlayer.style.display = 'none';
            youtubePlayer.src = '';
            filename.style.display = 'block';
            controls.style.display = 'flex';
            urlControls.style.display = 'none';
            filenameDisplay.style.display = 'block';
            youtubeCloseBtn.style.display = 'none';
        
            // ËøΩÂä†ÔºöoverlayDisplay„ÇíÂæ©ÂÖÉ
            overlayDisplay.style.display = 'block';
            overlayDisplay.classList.add('active');
            updateOverlayDisplay('„É≠„Éº„Ç´„É´„É¢„Éº„Éâ„Å´Êàª„Çä„Åæ„Åó„Åü');
        
            // ËøΩÂä†Ôºö„Éï„Ç°„Ç§„É´ÂãïÁîª„Çí‰∏ÄÊôÇÂÅúÊ≠¢
            if (!video.paused) {
                video.pause();
                playPauseBtn.textContent = '‚ñ∂Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                stopPeriodicSave();
            }
        
            // ‰øùÂ≠ò„Åï„Çå„Åü„Éó„É¨„Ç§„É™„Çπ„Éà„ÇíÂæ©ÂÖÉ
            if (playlist.length === 0) {
                const savedPlaylist = localStorage.getItem('playlist');
                const savedCurrentVideoIndex = localStorage.getItem('currentVideoIndex');
                if (savedPlaylist && savedCurrentVideoIndex) {
                    try {
                        const parsedPlaylist = JSON.parse(savedPlaylist);
                        const parsedIndex = parseInt(savedCurrentVideoIndex);
                        if (Array.isArray(parsedPlaylist) && parsedPlaylist.length > 0 && parsedIndex >= 0 && parsedIndex < parsedPlaylist.length) {
                            playlist = parsedPlaylist.map(path => ({
                                file: { path },
                                name: path
                            }));
                            currentVideoIndex = parsedIndex;
                        }
                    } catch (e) {
                        console.error('„Éó„É¨„Ç§„É™„Çπ„ÉàÂæ©ÂÖÉ„Ç®„É©„Éº:', e);
                    }
                }
            }
        
            updatePlaylistDisplay();
        
            if (playlist.length > 0) {
                filenameDisplay.innerHTML = `<option value="">ÂÜçÁîüÈÄî‰∏≠:‚ñ∂Ô∏è ${playlist[currentVideoIndex].name}</option>`;
                playVideo(playlist[currentVideoIndex].file);
                // ËøΩÂä†ÔºöÂÜçÁîü„Åõ„Åö‰∏ÄÊôÇÂÅúÊ≠¢Áä∂ÊÖã„ÇíÁ∂≠ÊåÅ
                video.pause();
                playPauseBtn.textContent = '‚ñ∂Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                stopPeriodicSave();
            } else {
                video.src = '';
                filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
            }
        
            showControlsAndFilename();
            startPeriodicSave();
        }

        function hideURLInputControls() {
            urlControls.style.display = 'none';
            urlInput.style.display = 'none';
            urlConfirmBtn.style.display = 'none';
            urlCancelBtn.style.display = 'none';
            urlInput.value = '';
        }

        function showYouTubeControls() {
            clearTimeout(controlTimeout);
            youtubeCloseBtn.style.opacity = '1';
            controlTimeout = setTimeout(() => {
                if (!isMouseOverControls) {
                    youtubeCloseBtn.style.opacity = '0';
                }
            }, overlayTimeout);
            // ËøΩÂä†ÔºöYouTube„É¢„Éº„Éâ‰∏≠„ÅØoverlayDisplay„ÇíË°®Á§∫„Åó„Å™„ÅÑ
            overlayDisplay.style.display = 'none';
            overlayDisplay.classList.remove('active');
        }

        youtubeCloseBtn.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(controlTimeout);
            youtubeCloseBtn.style.opacity = '1';
        });

        youtubeCloseBtn.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showYouTubeControls();
        });

        videoContainer.addEventListener('mousemove', () => {
            if (isYouTubeMode) {
                showYouTubeControls();
            } else {
                showControlsAndFilename();
            }
        });

        // ÊèèÁîª„É¢„Éº„Éâ
        fitModeBtn.addEventListener('click', () => {
            fitMode = fitMode === 'contain' ? 'cover' : 'contain';
            video.style.objectFit = fitMode;
            fitModeBtn.textContent = fitMode === 'contain' ? '‚ÜïÔ∏è' : '‚ÜîÔ∏è';
            fitModeBtn.setAttribute('data-tooltip', fitMode === 'contain' ? 'Ê®™„Å´Âêà„Çè„Åõ„Çã' : 'Á∏¶„Å´Âêà„Çè„Åõ„Çã');
            localStorage.setItem('fitMode', fitMode);
            showControlsAndFilename();
        });

        // „Ç≥„É≥„Éà„É≠„Éº„É´„Å®„Éï„Ç°„Ç§„É´Âêç„ÅÆË°®Á§∫ÁÆ°ÁêÜ
        function showControlsAndFilename() {
            if (isYouTubeMode) {
                showYouTubeControls();
                return;
            }
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
            clearTimeout(timeout);
            if (!isMouseOverControls) {
                timeout = setTimeout(() => {
                    if (!isMouseOverControls) {
                        controls.style.opacity = '0';
                        filename.style.opacity = '0';
                        overlayDisplay.classList.remove('active');
                        videoContainer.style.cursor = 'none';
                        setTimeout(() => {
                            overlayDisplay.style.display = 'none';
                        }, 300);
                    }
                }, overlayTimeout);
            }
        }

        function hideControlsAndFilename() {
            if (isYouTubeMode) {
                youtubeCloseBtn.style.opacity = '0';
                return;
            }
            controls.style.opacity = '0';
            filename.style.opacity = '0';
            overlayDisplay.classList.remove('active');
            videoContainer.style.cursor = 'none';
            clearTimeout(timeout);
            setTimeout(() => {
                overlayDisplay.style.display = 'none';
            }, 300);
        }

        controls.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(timeout);
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
        });

        controls.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showControlsAndFilename();
        });

        filename.addEventListener('mouseover', () => {
            isMouseOverControls = true;
            clearTimeout(timeout);
            controls.style.opacity = '1';
            filename.style.opacity = '1';
            videoContainer.style.cursor = 'auto';
            if (overlayDisplay.classList.contains('active')) {
                overlayDisplay.style.display = 'block';
                overlayDisplay.classList.add('active');
            }
        });

        filename.addEventListener('mouseleave', () => {
            isMouseOverControls = false;
            showControlsAndFilename();
        });

        // ÊôÇÈñì„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00:00';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            const currentTime = formatTime(video.currentTime);
            const duration = formatTime(video.duration);
            timeDisplay.textContent = `${currentTime} / ${duration}`;
        }

        function updateVolumeDisplay() {
            const volumePercent = Math.round(video.volume * 100);
            volumeDisplay.textContent = `${volumePercent}%`;
        }

        function updateOverlayDisplay(content, isInitial = false) {
            overlayDisplay.textContent = content;
            const overlayFontSize = parseFloat(overlayDisplay.style.fontSize) || 90;
            const charCount = content.length;
            const charWidth = overlayFontSize * 0.6;
            let overlayWidth = charCount * charWidth + 40;
            overlayWidth = Math.max(200, Math.min(overlayWidth, window.innerWidth * 0.8));
            overlayDisplay.style.width = `${overlayWidth}px`;
            overlayDisplay.style.display = 'block';
            overlayDisplay.classList.add('active');
            if (!isInitial) {
                showControlsAndFilename();
            }
        }

        function hideOverlayDisplay() {
            overlayDisplay.classList.remove('active');
            setTimeout(() => {
                overlayDisplay.style.display = 'none';
            }, 300);
        }

        // ÂãïÁîª„É°„Çø„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        video.addEventListener('loadedmetadata', () => {
            seekBar.max = 100;
            updateTimeDisplay();
            updateVolumeDisplay();
            const rawCurrentTime = localStorage.getItem('currentTime');
            const savedCurrentTime = parseFloat(rawCurrentTime);
            if (!isNaN(savedCurrentTime) && savedCurrentTime > 0 && savedCurrentTime <= video.duration) {
                video.currentTime = savedCurrentTime;
                updateTimeDisplay();
                video.play().catch(() => {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                    playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                });
                playPauseBtn.textContent = '‚è∏Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', '‰∏ÄÊôÇÂÅúÊ≠¢ÔºàSpaceÔºâ');
                startPeriodicSave();
                savePlaylistAndPlaybackState();
            } else {
                video.currentTime = 0;
                video.play().catch(() => {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                    playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                });
                playPauseBtn.textContent = '‚è∏Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', '‰∏ÄÊôÇÂÅúÊ≠¢ÔºàSpaceÔºâ');
                startPeriodicSave();
                savePlaylistAndPlaybackState();
            }
        });

        video.addEventListener('error', () => {
            if (video.src && /\.(mp4|mkv|webm)$/i.test(video.src)) {
                stopPeriodicSave();
                playPauseBtn.textContent = '‚ñ∂Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
            }
        });

        video.addEventListener('mousemove', showControlsAndFilename);

        video.addEventListener('click', (event) => {
            event.preventDefault();
            showControlsAndFilename();
        });

        video.addEventListener('dblclick', (event) => {
            event.preventDefault();
            if (!document.fullscreenElement) {
                if (videoContainer.requestFullscreen) {
                    videoContainer.requestFullscreen();
                    fullscreenBtn.textContent = '‚ùå';
                    fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ëß£Èô§');
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = 'üñ•Ô∏è';
                    fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫');
                }
            }
            showControlsAndFilename();
        });

        video.addEventListener('touchstart', (event) => {
            event.preventDefault({ passive: false });
            isDragging = false;
            touchStartTime = Date.now();
            const currentTime = touchStartTime;
            if (currentTime - lastTouchTime < 400) {
                event.stopPropagation();
                if (!document.fullscreenElement) {
                    if (videoContainer.requestFullscreen) {
                        videoContainer.requestFullscreen();
                        fullscreenBtn.textContent = '‚ùå';
                        fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ëß£Èô§');
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        fullscreenBtn.textContent = 'üñ•Ô∏è';
                        fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫');
                    }
                }
                showControlsAndFilename();
            } else {
                const touch = event.touches[0];
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                wasPlaying = !video.paused;
                lastTouchTime = currentTime;
            }
        }, { passive: false });

        video.addEventListener('touchmove', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault({ passive: false });
            const touch = event.touches[0];
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);

            if (absDeltaX > 5 || absDeltaY > 5) {
                isDragging = true;
            }

            if (isDragging && video.duration) {
                if (absDeltaX > absDeltaY && absDeltaX > 5) {
                    isVolumeDragging = false;
                    const seekStep = video.duration / 1000;
                    const seekTime = deltaX * seekStep * seekSensitivity;
                    let newTime = video.currentTime + seekTime;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`üïì ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                } else if (absDeltaY > absDeltaX && absDeltaY > 5) {
                    isVolumeDragging = true;
                    const newVolume = video.volume - (deltaY * volumeStep);
                    video.volume = Math.max(0, Math.min(1, newVolume));
                    volumeBar.value = video.volume;
                    lastVolume = video.volume;
                    volumeMuteBtn.textContent = video.volume === 0 ? 'üîá' : 'üîä';
                    volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
                    updateVolumeDisplay();
                    updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
                    localStorage.setItem('volume', video.volume);
                }
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                showControlsAndFilename();
            }
        }, { passive: false });

        video.addEventListener('touchend', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault({ passive: false });
            event.stopPropagation();
            const touchEndTime = Date.now();
            const touch = event.changedTouches[0];
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);
            const touchDuration = touchEndTime - touchStartTime;

            if (!isDragging && touchDuration < 750 && absDeltaX < 15 && absDeltaY < 15) {
                if (controls.style.opacity === '1') {
                    isMouseOverControls = false;
                    hideControlsAndFilename();
                } else {
                    showControlsAndFilename();
                }
            } else if (isDragging) {
                isDragging = false;
                isVolumeDragging = false;
                showControlsAndFilename();
            }
        }, { passive: false });

        video.addEventListener('mousedown', (event) => {
            if (isYouTubeMode) return;
            if (event.button === 0) {
                isDragging = true;
                dragStartX = event.clientX;
                dragStartY = event.clientY;
                wasPlaying = !video.paused;
                event.preventDefault();
            }
        });

        video.addEventListener('mousemove', (event) => {
            if (isYouTubeMode) return;
            if (isDragging && video.duration) {
                const deltaX = event.clientX - dragStartX;
                const deltaY = event.clientY - dragStartY;
                const absDeltaX = Math.abs(deltaX);
                const absDeltaY = Math.abs(deltaY);

                if (absDeltaX > absDeltaY && absDeltaX > 5) {
                    isVolumeDragging = false;
                    const seekStep = video.duration / 1000;
                    const seekTime = deltaX * seekStep * seekSensitivity;
                    let newTime = video.currentTime + seekTime;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`üïì ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                } else if (absDeltaY > absDeltaX && absDeltaY > 5) {
                    isVolumeDragging = true;
                    const newVolume = video.volume - (deltaY * volumeStep);
                    video.volume = Math.max(0, Math.min(1, newVolume));
                    volumeBar.value = video.volume;
                    lastVolume = video.volume;
                    volumeMuteBtn.textContent = video.volume === 0 ? 'üîá' : 'üîä';
                    volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
                    updateVolumeDisplay();
                    updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
                    localStorage.setItem('volume', video.volume);
                }

                dragStartX = event.clientX;
                dragStartY = event.clientY;
                showControlsAndFilename();
            }
        });

        video.addEventListener('mouseup', () => {
            if (isYouTubeMode) return;
            isDragging = false;
            isVolumeDragging = false;
            showControlsAndFilename();
        });

        video.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            isDragging = false;
            isVolumeDragging = false;
            showControlsAndFilename();
        });

        seekBar.addEventListener('mousemove', (e) => {
            if (isYouTubeMode) return;
            e.stopPropagation();
            if (video.duration) {
                const rect = seekBar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                if (x >= 0 && x <= rect.width) {
                    const time = video.duration * (x / rect.width);
                    updateOverlayDisplay(`üïì ${formatTime(time)}`);
                }
                showControlsAndFilename();
            }
        });

        seekBar.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            if (!isDragging && !seekBar.matches(':active')) {
                hideOverlayDisplay();
            }
        });

        volumeBar.addEventListener('mousemove', (e) => {
            if (isYouTubeMode) return;
            e.stopPropagation();
            const rect = volumeBar.getBoundingClientRect();
            const x = e.clientX - rect.left;
            if (x >= 0 && x <= rect.width) {
                const volume = (x / rect.width);
                const volumePercent = Math.round(volume * 100);
                updateOverlayDisplay(`${volume === 0 ? 'üîá' : 'üîä'} ${volumePercent}%`);
            }
            showControlsAndFilename();
        });

        volumeBar.addEventListener('mouseleave', () => {
            if (isYouTubeMode) return;
            if (!isVolumeDragging && !volumeBar.matches(':active')) {
                hideOverlayDisplay();
            }
        });

        sizeSelect.addEventListener('change', () => {
            const value = parseInt(sizeSelect.value);
            localStorage.setItem('controlSize', value);
            updateControlSize(value);
            showControlsAndFilename();
        });

        video.addEventListener('timeupdate', () => {
            if (isYouTubeMode) return;
            if (!isDragging && !seekBar.matches(':active')) {
                const value = (100 / video.duration) * video.currentTime;
                seekBar.value = value;
                updateTimeDisplay();
            }
        });

        // [Â§âÊõ¥] „Éó„É¨„Ç§„É™„Çπ„ÉàË°®Á§∫Ôºà„Éï„É´„Éë„ÇπÂØæÂøúÔºâ
        function updatePlaylistDisplay() {
            filenameDisplay.innerHTML = '';
            if (playlist.length === 0) {
                const savedPlaylist = localStorage.getItem('playlist');
                if (savedPlaylist) {
                    try {
                        const parsedPlaylist = JSON.parse(savedPlaylist);
                        if (Array.isArray(parsedPlaylist) && parsedPlaylist.length > 0) {
                            // [Â§âÊõ¥] „Éï„É´„Éë„Çπ„ÇíË°®Á§∫
                            filenameDisplay.innerHTML = `<option value="">ÂÜçÁîüÈÄî‰∏≠:‚ñ∂Ô∏è ${parsedPlaylist[currentVideoIndex]}</option>`;
                        } else {
                            filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                        }
                    } catch (e) {
                        filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                    }
                } else {
                    filenameDisplay.innerHTML = `<option value="">${appNameAndCopyrightValue}</option>`;
                }
                return;
            }
            playlist.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                // [Â§âÊõ¥] „Éï„É´„Éë„Çπ„ÇíË°®Á§∫
                option.textContent = (index === currentVideoIndex ? '‚ñ∂Ô∏è ' : '') + item.name;
                filenameDisplay.appendChild(option);
            });
            filenameDisplay.value = currentVideoIndex;
        }

        filenameDisplay.addEventListener('change', () => {
            if (isYouTubeMode) return;
            const selectedIndex = parseInt(filenameDisplay.value);
            if (!isNaN(selectedIndex)) {
                currentVideoIndex = selectedIndex;
                localStorage.setItem('currentTime', 0);
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
        });

        video.addEventListener('ended', () => {
            if (isYouTubeMode) return;
            video.currentTime = 0;
            localStorage.setItem('currentTime', video.currentTime);
            if (currentVideoIndex < playlist.length - 1) {
                currentVideoIndex++;
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
            } else {
                video.src = '';
                savePlaylistAndPlaybackState();
                stopPeriodicSave();
            }
        });

        // [Â§âÊõ¥] ÂãïÁîªÂÜçÁîüÈñ¢Êï∞
        function playVideo(file) {
            video.src = file.path; // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„Éë„Çπ„ÇíÁõ¥Êé•ÊåáÂÆö
            updatePlaylistDisplay();
            const savedVolume = localStorage.getItem('volume');
            if (savedVolume && !isNaN(savedVolume) && savedVolume >= 0 && savedVolume <= 1) {
                video.volume = savedVolume;
                volumeBar.value = savedVolume;
                lastVolume = savedVolume;
                volumeMuteBtn.textContent = savedVolume == 0 ? 'üîá' : 'üîä';
                volumeMuteBtn.setAttribute('data-tooltip', savedVolume == 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
            } else {
                video.volume = volumeBar.value || 0.2;
                lastVolume = video.volume;
                volumeMuteBtn.textContent = 'üîä';
                volumeMuteBtn.setAttribute('data-tooltip', '„Éü„É•„Éº„Éà');
            }
            updateVolumeDisplay();
            video.load();
            
            // ‰øùÂ≠ò„Åï„Çå„ÅüÂÜçÁîüÊôÇÈñì„ÇíÂæ©ÂÖÉ
            const savedCurrentTime = parseFloat(localStorage.getItem('currentTime'));
            if (!isNaN(savedCurrentTime) && savedCurrentTime >= 0) {
                video.currentTime = savedCurrentTime;
            }
            
            // ÂÜçÁîüÈñãÂßã
            video.play().catch(() => {
                playPauseBtn.textContent = '‚ñ∂Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
            });
            playPauseBtn.textContent = '‚è∏Ô∏è';
            playPauseBtn.setAttribute('data-tooltip', '‰∏ÄÊôÇÂÅúÊ≠¢ÔºàSpaceÔºâ');
            startPeriodicSave();
            showControlsAndFilename();
        }

        function togglePlayPause() {
            if (isYouTubeMode) return;
            if (video.paused) {
                video.play().catch(() => {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                    playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                });
                playPauseBtn.textContent = '‚è∏Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', '‰∏ÄÊôÇÂÅúÊ≠¢ÔºàSpaceÔºâ');
                startPeriodicSave();
            } else {
                video.pause();
                playPauseBtn.textContent = '‚ñ∂Ô∏è';
                playPauseBtn.setAttribute('data-tooltip', 'ÂÜçÁîüÔºàSpaceÔºâ');
                localStorage.setItem('currentTime', video.currentTime);
                stopPeriodicSave();
            }
            showControlsAndFilename();
        }

        playPauseBtn.addEventListener('click', togglePlayPause);

        video.addEventListener('contextmenu', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault();
            event.stopPropagation();
            togglePlayPause();
        });

        prevVideoBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (currentVideoIndex > 0) {
                currentVideoIndex--;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
            showControlsAndFilename();
        });

        rewindBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.duration) {
                wasPlaying = !video.paused;
                let newTime = video.currentTime - 30;
                newTime = Math.max(0, newTime);
                video.currentTime = newTime;
                seekBar.value = (100 / video.duration) * newTime;
                updateTimeDisplay();
                updateOverlayDisplay(`üïì ${formatTime(newTime)}`);
                localStorage.setItem('currentTime', newTime);
                showControlsAndFilename();
            }
        });

        fastForwardBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.duration) {
                wasPlaying = !video.paused;
                let newTime = video.currentTime + 30;
                newTime = Math.min(video.duration, newTime);
                video.currentTime = newTime;
                seekBar.value = (100 / video.duration) * newTime;
                updateTimeDisplay();
                updateOverlayDisplay(`üïì ${formatTime(newTime)}`);
                localStorage.setItem('currentTime', newTime);
                showControlsAndFilename();
            }
        });

        nextVideoBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (currentVideoIndex < playlist.length - 1) {
                currentVideoIndex++;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
            }
            showControlsAndFilename();
        });

        video.addEventListener('wheel', (event) => {
            if (isYouTubeMode) return;
            event.preventDefault();
            const volumeStep = 0.05;
            if (event.deltaY < 0) {
                video.volume = Math.min(1, video.volume + volumeStep);
            } else if (event.deltaY > 0) {
                video.volume = Math.max(0, video.volume - volumeStep);
            }
            volumeBar.value = video.volume;
            lastVolume = video.volume;
            volumeMuteBtn.textContent = video.volume === 0 ? 'üîá' : 'üîä';
            volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
            showControlsAndFilename();
        });

        seekBar.addEventListener('input', () => {
            if (isYouTubeMode) return;
            wasPlaying = !video.paused;
            const time = video.duration * (seekBar.value / 100);
            video.currentTime = time;
            updateTimeDisplay();
            updateOverlayDisplay(`üïì ${formatTime(time)}`);
            localStorage.setItem('currentTime', time);
        });

        volumeMuteBtn.addEventListener('click', () => {
            if (isYouTubeMode) return;
            if (video.volume === 0) {
                video.volume = lastVolume || 0.2;
                volumeBar.value = video.volume;
                volumeMuteBtn.textContent = 'üîä';
                volumeMuteBtn.setAttribute('data-tooltip', '„Éü„É•„Éº„Éà');
            } else {
                lastVolume = video.volume;
                video.volume = 0;
                volumeBar.value = 0;
                volumeMuteBtn.textContent = 'üîá';
                volumeMuteBtn.setAttribute('data-tooltip', '„Éü„É•„Éº„ÉàËß£Èô§');
            }
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
        });

        volumeBar.addEventListener('input', () => {
            if (isYouTubeMode) return;
            video.volume = volumeBar.value;
            lastVolume = video.volume;
            volumeMuteBtn.textContent = video.volume === 0 ? 'üîá' : 'üîä';
            volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
            updateVolumeDisplay();
            updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
            localStorage.setItem('volume', video.volume);
        });

        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                if (videoContainer.requestFullscreen) {
                    videoContainer.requestFullscreen();
                    fullscreenBtn.textContent = '‚ùå';
                    fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ëß£Èô§');
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = 'üñ•Ô∏è';
                    fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫');
                }
            }
            showControlsAndFilename();
        });

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                fullscreenBtn.textContent = 'üñ•Ô∏è';
                fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ë°®Á§∫');
            } else {
                fullscreenBtn.textContent = '‚ùå';
                fullscreenBtn.setAttribute('data-tooltip', '„Éï„É´„Çπ„ÇØ„É™„Éº„É≥Ëß£Èô§');
            }
        });

        document.addEventListener('keydown', (event) => {
            if (isYouTubeMode) return;
            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                if (video.duration) {
                    wasPlaying = !video.paused;
                    const delta = event.key === 'ArrowLeft' ? -5 : 5;
                    let newTime = video.currentTime + delta;
                    newTime = Math.max(0, Math.min(video.duration, newTime));
                    video.currentTime = newTime;
                    seekBar.value = (100 / video.duration) * newTime;
                    updateTimeDisplay();
                    updateOverlayDisplay(`üïì ${formatTime(newTime)}`);
                    localStorage.setItem('currentTime', newTime);
                    showControlsAndFilename();
                }
            } else if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                const delta = event.key === 'ArrowUp' ? 0.05 : -0.05;
                video.volume = Math.max(0, Math.min(1, video.volume + delta));
                volumeBar.value = video.volume;
                lastVolume = video.volume;
                volumeMuteBtn.textContent = video.volume === 0 ? 'üîá' : 'üîä';
                volumeMuteBtn.setAttribute('data-tooltip', video.volume === 0 ? '„Éü„É•„Éº„ÉàËß£Èô§' : '„Éü„É•„Éº„Éà');
                updateVolumeDisplay();
                updateOverlayDisplay(`${video.volume === 0 ? 'üîá' : 'üîä'} ${Math.round(video.volume * 100)}%`);
                localStorage.setItem('volume', video.volume);
                showControlsAndFilename();
            } else if (event.key === ' ') {
                event.preventDefault();
                togglePlayPause();
            } else if (event.key === 'PageUp' && playlist.length > 0) {
                if (currentVideoIndex > 0) {
                    currentVideoIndex--;
                    localStorage.setItem('currentTime', 0);
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                    showControlsAndFilename();
                }
            } else if (event.key === 'PageDown' && playlist.length > 0) {
                if (currentVideoIndex < playlist.length - 1) {
                    currentVideoIndex++;
                    localStorage.setItem('currentTime', 0);
                    updatePlaylistDisplay();
                    playVideo(playlist[currentVideoIndex].file);
                    savePlaylistAndPlaybackState();
                    showControlsAndFilename();
                }
            } else if (event.key === 'Home' && playlist.length > 0) {
                currentVideoIndex = 0;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
                showControlsAndFilename();
            } else if (event.key === 'End' && playlist.length > 0) {
                currentVideoIndex = playlist.length - 1;
                localStorage.setItem('currentTime', 0);
                updatePlaylistDisplay();
                playVideo(playlist[currentVideoIndex].file);
                savePlaylistAndPlaybackState();
                showControlsAndFilename();
            }
        });
    </script>
</body>
</html>